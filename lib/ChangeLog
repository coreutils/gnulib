2003-09-25  Simon Josefsson  <jas@extundo.com>
            Bruno Haible  <bruno@clisp.org>

	* getdomainname.h: New file.
	* getdomainname.c: New file.

2003-09-19  Karl Berry  <karl@gnu.org>

	* argp.h: update from libc.

2003-09-16  Paul Eggert  <eggert@twinsun.com>

	* linebuffer.c (readlinebuffer): Return NULL immediately upon
	input error, instead of returning NULL the next time we are called
	(and therefore losing track of errno).

2003-09-15  Paul Eggert  <eggert@twinsun.com>

	* getndelim2.c (getndelim2): Don't trash errno when a read
	fails, so that the caller gets the proper errno.

	* readutmp.c (read_utmp): Likewise.
	Check for fstat error.  Close stream and free storage
	when failing.

2003-09-14  Bruno Haible  <bruno@clisp.org>

	* fwriteerror.h: New file.
	* fwriteerror.c: New file.

2003-09-14  Jim Meyering  <jim@meyering.net>

	* getloadavg.c: Correct cpp indentation.
	* strdup.c: Likewise.
	* vasnprintf.c: Likewise.

2003-09-12  Paul Eggert  <eggert@twinsun.com>

	* argmatch.c, fatal.c, xgethostname.c, xmalloc.c: Include exit.h.
	* obstack.c [!defined _LIBC]: Likewise.
	* argmatch.c (EXIT_FAILURE): Remove; now done by exit.h
	* exitfail.c, fatal.c, xgethostname.c, xmalloc.c: Likewise.
	* exitfail.c: Don't include stdlib.h; no longer needed.

	More changes to assume C89 or better.

	* error.c (error_tail): Assume vprintf.

	* argmatch.c (getenv): Remove decl.
	* progreloc.c (get_full_program_name): Define via prototype.
	* setenv.c (clearenv): Likewise.
	* stpncpy.c: Do not include <string.h> or <sys/types.h>; not
	needed.
	* strdup.c: Include <stdlib.h>, <string.h> unconditionally.
	(malloc, memcpy): Remove decls.
	* strftime.c (HAVE_LIMITS_H, STDC_HEADERS) [defined _LIBC]: Remove.
	(HAVE_MEMCPY) [defined emacs && !defined HAVE_BCOPY]: Remove.
	Include <limits.h>, <stddef.h>, <stdlib.h>, <string.h> unconditionally.
	(memcpy): Remove macro.
	(MEMCPY) [!defined COMPILE_WIDE]: Define to memcpy unconditionally.
	(__P): Remove.  All uses removed.
	(PTR): Remove.  All uses changed to void *.
	(CHAR_BIT, NULL): Remove.
	(spaces, zeros, memset_space, memset_zero)
	[!defined memset && !defined HAVE_MEMSET && !defined _LIBC]:
	Remove.
	(LOCALE_PARAM, LOCALE_PARAM_DECL): Remove.
	(memcpy_lowcase, memcpy_uppcase, tm_diff, iso_week_days):
	Define with prototype.
	Remove now-unnecessary prototype decl.
	(extra_args_spec): Assume ANSI C.  All uses changed.
	(extra_args_spec_iso): Remove.
	(my_strftime, emacs_strftimeu): Define via prototype.
	* strtod.c: Include <float.h>, <stdlib.h>, <string.h>
	unconditionally.
	(DBL_MAX, DBL_MIN, HUGE_VAL, NULL): Remove decls.
	* strtoimax.c: Include <stdlib.h> unconditionally.
	(strtoul, strtol): Remove decls.
	* strtol.c (STDC_HEADERS, HAVE_LIMITS_H, NULL, ULONG_MAX,
	LONG_MAX): Remove.
	Include <limits.h>, <stddef.h>, <stdlib.h>, <string.h> unconditionally.
	(LOCALE_PARAM_DECL): Remove.  All uses changed to LOCALE_PARAM_PROTO.
	(LOCALE_PARAM_PROTO): New macro.
	(INTERNAL, INTERNAL1, WEAKNAME): Assume ANSI C, not K&R.
	(INTERNAL (strtol), strtol): Define with a prototype.
	(PARAMS): Remove.  All uses removed.
	* tempname.c: Include <string.h> unconditionally.
	* userspec.c: Include <stdlib.h>, <string.h> unconditionally.
	* xgethostname.c (main): Define with a prototype.
	* xmalloc.c: Include "xalloc.h" first, to check interface.
	Include <stdlib.h> unconditionally.
	(calloc, malloc, realloc, free): Remove decls.
	* xstrtod.c: Include "xstrtod.h" first, to check interface.
	Include <stdlib.h> unconditionally.  Sort include file names.
	(strtod): Remove.
	(xstrtod): Define with a prototype.
	* xstrtol.c: Include <stdlib.h>, <string.h> unconditionally.
	(strtol, strtoul): Remove decls.

2003-09-11  Paul Eggert  <eggert@twinsun.com>

	* strndup.c: Don't include <stdio.h>, <sys/types.h>.
	Include <stdlib.h>, <string.h> unconditionally.
	Remove now-unnecessary cast to char *.
	* strnlen.c: Include <string.h> unconditionally.
	* yesno.c (yesno): Define with a prototype.

2003-09-10  Bruno Haible  <bruno@clisp.org>

	* strcspn.c: Include <string.h> unconditionally.
	* strpbrk.c: Include <string.h> unconditionally.
	* strstr.c: Include <string.h> unconditionally.
	* unicodeio.c: Include <string.h> unconditionally.
	* setenv.c: Include <stdlib.h> and <string.h> unconditionally.
	* unsetenv.c: Likewise.
	* xreadlink.c: Include <stdlib.h> unconditionally.
	* yesno.c: Include <stdlib.h> unconditionally.
	(rpmatch): Add prototype.

2003-09-10  Jim Meyering  <jim@meyering.net>

	* error.c: Correct indentation of cpp directives.

2003-09-09  Paul Eggert  <eggert@twinsun.com>

	More K&R removal.

	* acosl.c (main): Use a prototype.
	* asinl.c, cosl.c, expl.c, frexpl.c, ldexpl.c, sinl.c,
	tanl.c: Likewise.

	* getloadavg.c (getloadavg, main): Define via prototypes.

	* getopt.h (struct option.name): Assume C89, and use 'const'.
	(getopt, etopt_long, getopt_long_only, _getopt_internal)
	[defined __GNU_LIBRARY__]: Assume C89, so we can always declare
	with a prototype.
	* getopt.c (const): Remove macro.
	Include <string.h> unconditionally.
	(my_index): Remove; all uses changed to strchr.
	(strlen): Remove decl.
	(exchange): Remove forward decl; no longer needed.
	(exchange, _getopt_initialize, _getopt_internal, getopt, main):
	Define with prototype.
	* getopt1.c (const): Remove macro.
	(getopt_long, getopt_long_only, main): Define with prototype.

	* getugroups.c: Include <string.h> unconditionally.

	* getusershell.c: Include <stdlib.h> unconditionally.
	(getusershell, setusershell, endusershell, readname, main):
	Define with prototypes.

	* group-member.c: Include group-member.h first.
	Include <stdlib.h> unconditionally.

	* hard-locale.c: Include hard-locale.h first.
	Include <stdlib.h>, <string.h> unconditionally.

	* hash.c (free, malloc): Remove decls.
	Include <stdlib.h> unconditionally.

	* human.c: Include <stdlib.h>, <string.h> unconditionally.
	(getenv): Do not declare.

	* idcache.c: Include <string.h> unconditionally.

	* long-options.c: Include long-options.h first, to test interface.
	Include <stdlib.h> unconditionally.

	* makepath.c: Include makepath.h first, to test interface.
	Include <stdlib.h> and <string.h> unconditionally.

	* linebuffer.c: Include <stdlib.h>.
	(free): Remove decl.

	* malloc.c: Include <stdlib.h>, for malloc; don't bother with stddef.h.
	rpl_malloc returns void *, not char *.
	* realloc.c (rpl_realloc): Likewise.  Also, define with a prototype.

	* md5.h: Include <limits.h> unconditionally.
	(UINT_MAX_32_BITS): Don't worry about non-__STDC__ case.
	(__P): Remove; all uses removed.
	* md5.c: Include "md5.h" first.
	(md5_init_ctx, md5_read_ctx, md5_finish_ctx, md5_stream,
	md5_buffer, md5_process_bytes, md5_process_block):
	Define with prototypes.
	* sha.h (__P): Remove all uses.  (It wasn't defined??)
	* sha.c: Include "sha.h" first.
	Include <stdlib.h>, <string.h> unconditionally.

	* memchr.c (__ptr_t): Remove; all uses changed to void *.
	* memcmp.c (__ptr_t): Likewise.
	* memrchr.c (__ptr_t): Likewise.
	* memchr.c, memcmp.c, memcoll.c, memrchr.c:
	Include <string.h> unconditionally.
	* memchr.c, memrchr.c: Include <limits.h> unconditionally.
	* memchr.c: Include <stdlib.h> unconditionally.
	* memchr.c (LONG_MAX): Remove.
	* memrchr.c (LONG_MAX): Likewise.
	* memchr.c (__memchr): Define via a prototype.
	* memrchr.c (__memrchr): Likewise.
	* memcmp.c (__P): Remove, and remove all uses.
	(memcmp_bytes, memcmp_common_alignment, memcmp_not_common_alignment):
	Remove forward decls; no longer needed.
	* memcpy.c, memmove.c, memset.c: Include <stddef.h>.
	Use types required by C89 in prototype.

	* mkdir.c: Include <stdlib.h>, <string.h> unconditionally.
	* savedir.c: Likewise.
	* mkdir.c (free): Remove decl.
	* rmdir.c (rmdir): Define with a prototype.
	* savedir.c: Include savedir.h first, to test interface.

	* mktime.c (STDC_HEADERS): Remove.
	Include <stdlib.h>, <string.h> unconditionally.

	* modechange.c: Include <stdlib.h> unconditionally.
	(malloc): Remove decl.

	* mountlist.c: Include <stdlib.h>, <string.h> unconditionally.
	(free): Remove decl.

	* obstack.h (PTR_INT_TYPE) [!defined __PTRDIFF_TYPE__]:
	Define to ptrdiff_t, without bothering to check HAVE_STDDEF_H.
	(This type really should be intptr_t, but that's a C99ism.)
	(_obstack_memcpy): Remove: all uses changed to memcpy.
	Include <string.h> unconditionally.
	(struct obstack): Assume __STDC__ for types of members
	chunkfun, freefun, extra_arg.
	(_obstack_newchunk, _obstack_free, _obstack_begin, _obstack_begin_1,
	_obstack_memory_used, obstack_alloc_failed_handler, obstack_init,
	obstack_begin, obstack_specify_allocation,
	obstack_specify_allocation_with_arg, obstack_chunkfun,
	obstack_freefun, obstack_free) [! (defined __STDC__ && __STDC__)]:
	Remove unprototyped decls and the macros that use them.
	* obstack.c (POINTER): Remove.  All uses changed to void *.
	(obstack_alloc_failed_handler, CALL_CHUNKFUN, CALL_FREEFUN,
	_obstack_begin, _obstack_begin_1, _obstack_allocated_p)
	(defined __STDC__ && __STDC__)]:
	Remove nonprototyped code.
	Include <stdlib.h> unconditionally.
	(_obstack_begin, _obstack_begin_1, _obstack_newchunk,
	_obstack_allocated_p, _obstack_free, obstack_free,
	_obstack_memory_used, print_and_abort):
	Define using prototypes.
	(obstack_1grow, obstack_1grow_fast, obstack_alloc, obstack_base,
	obstack_blank, obstack_blank_fast, obstack_copy, obstack_copy0,
	obstack_finish, obstack_grow, obstack_grow0, obstack_make_room,
	obstack_next_free, obstack_object_size, obstack_room) [0]:
	Remove unused, unprototyped code.

	* path-concat.c: Include <stdlib.h>, <string.h> unconditionally.

	* physmem.c (physmem_total, physmem_available, main): Define
	with prototypes.

	* posixtm.c: Include <stdlib.h>, <string.h> unconditionally.
	(main): Define with a prototype.

	* posixver.c (getenv): Remove decl.

	* putenv.c (malloc): Returns void *, not char *.
	Include <string.h> unconditionally.
	(strchr, memcpy, NULL): Do not define.

	* readtokens.c: Include readtokens.h first, to test interface.
	Include <stdlib.h>, <string.h> unconditionally.
	(init_tokenbuffer): Define with a prototype.

	* regex.c (PARAMS): Remove.  All uses removed.
	All uses of _RE_ARGS removed, too.
	Include <stddef.h>, <stdlib.h>, <string.h>, <limits.h>
	unconditionally.
	(bzero): Assume memset exists.
	(memcmp, memcpy, NULL): Remove.
	(SIGN_EXTEND_CHAR): Remove; all uses replaced by casts to signed
	char, or assignments to local vars of type signed char.
	(init_syntax_once, PREFIX(extract_number_and_incr),
	PREFIX(print_partial_compiled_pattern),
	PREFIX(print_compiled_pattern), PREFIX(print_double_string),
	convert_mbs_to_wcs, print_fastmap, re_set_syntax,
	PREFIX(regex_grow_registers), PREFIX(regex_compile),
	PREFIX(store_op1), PREFIX(store_op2), PREFIX(insert_op1),
	PREFIX(insert_op2), PREFIX(at_begline_loc_p),
	PREFIX(at_endline_loc_p), group_in_compile_stack, insert_space,
	wcs_compile_range, byte_compile_range, truncate_wchar,
	PREFIX(re_compile_fastmap), re_compile_fastmap, re_set_registers,
	re_search, re_search_2, PREFIX(re_search_2), re_match, re_match_2,
	count_mbs_length, wcs_re_match_2_internal,
	byte_re_match_2_internal, PREFIX(group_match_null_string_p),
	PREFIX(alt_match_null_string_p),
	PREFIX(common_op_match_null_string_p), PREFIX(bcmp_translate),
	re_compile_pattern, re_comp, re_exec, regcomp, regexec, regerror,
	regfree, PREFIX(extract_number)): Define with prototype.  Remove
	now-unnecessary declaration, if any.
	(byte_compile_range, PREFIX(regex_compile), re_comp, re_exec,
	regcomp, regexec):
	Remove now-unnecessary casts among pointer types.
	* regex.h (_RE_ARGS): Remove.  All uses removed.

	* rename.c: Include <stdlib.h>, <string.h> unconditionally.
	(free): Remove decl.

	* rpmatch.c: Include <stdlib.h> unconditionally.

	* same.c: Include <stdlib.h>, <string.h> unconditionally.
	(free): Remove decl.

	* save-cwd.c: Include <stdlib.h> unconditionally.
	* xgetcwd.c: Likewise.

	* stat.c: Include <stdlib.h>, <string.h> unconditionally.
	(free): Remove decl.

	* strchrnul.c (strchrnul): Define with a prototype.
	Fix bug: c_in was not converted to char before searching.

	The following changes are not K&R related:

	* group-member.h: Include <sys/types.h>, so that this file is
	self-contained.
	* makepath.h: Likewise.

	* getusershell.c (readname, default_index, line_size, readname):
	Use size_t, not int, for sizes.
	(readname): If the size overflows, report an error instead of
	looping forever.

2003-09-09  Derek Robert Price  <derek@ximbiot.com>

	* getndelim2.c: Assume stdlib.h per the C89 spec.

2003-09-08  Paul Eggert  <eggert@twinsun.com>

	Assume C89 or better; remove K&R cruft.
	A few of these changes were first proposed by Derek Robert Price
	in <http://mail.gnu.org/archive/html/bug-gnulib/2003-07/msg00105.html>.

	* addext.c: Include <string.h> unconditionally.
	* backupfile.c: Include <string.h>, <stdlib.h> unconditionally.
	Don't declare getenv or malloc.

	* alloca.c: Include <string.h>, <stdlib.h> unconditionally.
	(POINTER_TYPE, pointer): Remove; all uses changed to void *.
	(NULL): Remove.
	(find_stack_direction, alloca): Use prototypes.

	* atexit.c (atexit): Define using a prototype.

	* basename.c, dirname.c, stripslash.c:
	Include <string.h> unconditionally.

	* bcopy.c: Include <stddef.h>.
	(bcopy): Define with prototype, using 'const' and 'void' and 'size_t'.

	* canon-host.c: Include <stdlib.h>, <string.h> unconditionally.

	* error.h (error, error_at_line, error_print_progname)
	[! (defined (__STDC__) && __STDC__)]: Remove decls.
	* error.c: Include error.h first, to check interface.
	Include <stdarg.h>, <stdlib.h>, <string.h> unconditionally.
	(VA_START): Remove; all uses changeed to va_start.
	(exit, strerror): Remove decls.
	(error_print_progname): Prototype uncondionally.
	Don't include <errno.h>; no longer needed.
	(private_strerror): Remove.
	(error_tail): Always define.
	(error, error_at_line): Assume C89 or better; always use prototypes.
	* fatal.c: Include "fatal.h" first, to test interface.
	Include <stdarg.h>, <stdlib.h>, <string.h> unconditionally.
	(VA_START): Remove; all uses changed to va_start.
	[! (HAVE_VPRINTF || HAVE_DOPRNT || _LIBC)]: Remove support for
	this case.
	(exit): Remove decl.
	(fatal): Prototype unconditionally.  Assume va_start works.
	Abort at end, to pacify gcc.

	* euidaccess.c (main): Define with a prototype.

	* exclude.c: Include <stdlib.h>, <string.h> unconditionally.

	* exitfail.c: Include <stdlib.h> unconditionally.

	* fnmatch_.h (__P): Remove.  All uses changed to assume
	prototypes.
	* fnmatch.c: Include fnmatch.h first, to test interface.
	Include <string.h>, <stddef.h>, <stdlib.h> unconditionally.
	(getenv): Remove decl.
	(fnmatch): Define using a prototype.
	* fnmatch_loop.c (FCT): Remove forward decl; no longer needed.
	(FCT): Define using a prototype.

	* getdate.y: Include <stdlib.h>, <string.h> unconditionally.

	* gethostname.c: Include <stddef.h>.
	(gethostname): Define with prototype.  Length is size_t, not int.

2003-09-08  Paul Eggert  <eggert@twinsun.com>

	* getversion.c: Remove; was migrated to backupfile.c in 1997.
	getversion.c should have been removed then, but was accidentally
	preserved.

	* utime.c [!HAVE_UTIMES_NULL]: Include <sys/stat.h>, <fcntl.h>.
	(utime_null): Fix typo: 'st' was sometimes called 'sb'.

2003-09-07  Paul Eggert  <eggert@twinsun.com>

	* time_r.c (gmtime_r, localtime_r): Fix silly typo: missing arg to
	copy_tm_result.  Bug reported by Simon Josefsson in
	<http://mail.gnu.org/archive/html/bug-gnulib/2003-09/msg00028.html>.

2003-09-06  Paul Eggert  <eggert@twinsun.com>

	* time_r.c, time_r.h: New files.

	* mktime.c (my_mktime_localtime_r): Remove; all uses changed to
	__localtime_r.
	(__localtime_r) [!defined _LIBC]: New macro.  Include <time_r.h>.
	(__mktime_internal) [!defined _LIBC]: Now extern, not static.

	* strftime.c (my_strftime_gmtime_r): Remove; all uses changed to
	__gmtime_r.
	(my_strftime_localtime_r): Remove; all uses changed to __localtime_r.
	(__gtime_r, __localtime_r) [!HAVE_TM_GMTOFF]: New macros.
	Include <time_r.h>.

	* timegm.c: Switch to glibc implementation, with the following changes:
	[defined HAVE_CONFIG_H]: Include <config.h>.
	[!defined _LIBC]: Include "timegm.h" rather than <time.h>.
	(__mktime_internal) [!defined _LIBC]: New decl.
	(__gmtime_r) [!defined _LIBC]: New macro and function.
	(timegm): Use a prototype, since gnulib assumes C89.
	Do not bother declaring tmp to be const, as it's not really usefu.
	* timegm.h: Hoist "#include <time.h>" out of #ifdef.
	(timegm): Declare only if HAVE_DECL_TIMEGM.

2003-09-03  Paul Eggert  <eggert@twinsun.com>

	* human.c (human_readable): Fix bug that rounded 10501 to 10k.
	Bug reported by Lute Kamstra in
	<http://mail.gnu.org/archive/html/bug-gnulib/2003-09/msg00003.html>.

	* getdate.y (relative_time_table): Use tDAY_UNIT for "tomorrow",
	"yesterday", "today", and "now" rather than tMINUTE_UNIT.  Of
	course with correspondingly smaller numbers for tomorrow and
	yesterday.  From Tadayoshi Funaba.  Originally installed into
	sh-utils on 1999-08-07, but the patch got lost (I guess during the
	coreutils merge?).

2003-08-31  Simon Josefsson  <jas@extundo.com>

	* timegm.h: New file.
	* timegm.c: New file.  Based on wget-1.8.2/src/http.c:mktime_from_utc.

2003-08-31  Karl Berry  <karl@gnu.org>

	* argp.h: update from libc.

2003-08-28  Bruno Haible  <bruno@clisp.org>

	* binary-io.h: Undefine O_BINARY before defining it. This avoids a
	warning on QNX, which defines O_BINARY to 000000.

2003-08-24  Bruno Haible  <bruno@clisp.org>

	* binary-io.h: Include <stdio.h>, to avoid a compilation error when
	MSVC7 <stdio.h> is included later.

2003-08-20  Bruno Haible  <bruno@clisp.org>

	* progname.h: New file, from GNU gettext.
	* progname.c: New file, from GNU gettext.
	* progreloc.c: New file, from GNU gettext.

2003-08-19  Bruno Haible  <bruno@clisp.org>

	* xstrdup.c: Assume <string.h> exists.

2003-08-18  Jim Meyering  <jim@meyering.net>

	* setenv.h: Indent nested cpp directive.
	* vasnprintf.c: Remove trailing blanks.

2003-08-17  Simon Josefsson  <jas@extundo.com>
	    Bruno Haible  <bruno@clisp.org>

	* xstrndup.h: New file.
	* xstrndup.c: New file.

2003-08-17  Bruno Haible  <bruno@clisp.org>

	* strndup.h: New file.

2003-08-16  Paul Eggert  <eggert@twinsun.com>

	* regex.h, strdup.c, strtoll.c, strtoul.c: Do not normalize white
	space, undoing this 2003-08-12 change:
	<http://mail.gnu.org/archive/html/bug-gnulib/2003-08/msg00080.html>

2003-08-16  Jim Meyering  <jim@meyering.net>

	Merge from coreutils.
	* xstrtoimax.c: #else #if -> #elif.
	* xstrtoumax.c: Likewise.

2003-08-15  Paul Eggert  <eggert@twinsun.com>

	* config.charset, ref-add.sin, ref-del.sin: Use three spaces,
	rather than tab, after '#' in shell-script copyright notices.
	Suggested by Bruno Haible.

2003-08-15  Jim Meyering  <jim@meyering.net>
	and Paul Eggert  <eggert@twinsun.com>

	Merge from coreutils.
	* readutmp.h (HAVE_UTMPX_H): Undef if struct utmp has the ut_exit
	member but strut utmpx does not.  Needed for AIX 4.3.3.
	(UT_EXIT_E_TERMINATION, UT_EXIT_E_EXIT): Define.

2003-08-15  Jim Meyering  <jim@meyering.net>

	Merge from coreutils.
	* xgethostname.c: Include <stdlib.h>.
	(xghostname): Don't exit for anything other than memory-related
	failure; just return NULL.
	* userspec.c: Include "posixver.h".
	(parse_user_spec): Accept `.' as a separator only
	in pre-POSIX-200112 mode.
	* strtoimax.c: Use #elif rather than #else #if.
	* strftime.c (my_strftime) [!_LIBC && HAVE_TZNAME && HAVE_TZSET]:
	Remove function, now that we can rely on a working tzset function.
	[!_LIBC]: Ensure that the required autoconf test has been run.
	[!defined _NL_CURRENT && HAVE_STRFTIME]:
	Use underlying_strftime for %r.
	* sha.c: Merge in some clean-up and optimization changes from glibc.
	* sha.c (sha_stream) [BLOCKSIZE]: Move definition to top of file.
	Ensure that it is a multiple of 64.
	Rearrange loop exit tests so as to avoid performing an
	additional fread after encountering an error or EOF.
	* realloc.c: Update copyright date.

2003-08-14  Jim Meyering  <jim@meyering.net>

	Merge from coreutils.
	* obstack.h: Whitespace changes.
	* mountlist.c: Remove anachronistic casts of xmalloc, xrealloc,
	and xcalloc return values.
	(read_filesystem_list) [MOUNTED_GETFSSTAT]:
	Use MNT_NOWAIT, rather than MNT_WAIT.  Otherwise, `df DIR' could
	hang on OSF/1 5.1 for DIR on both local and remote file systems.
	Reported by (and fix confirmed by) Nelson H. F. Beebe.
	(read_filesystem_list) [MOUNTED_VMOUNT]: Detect any
	error from mntctl.
	Use mntctl's return value to drive the entry-processing loop, since
	we can't rely on the value of the vmt_length member in the last
	entry.  On some systems doing so could result in exhausting
	virtual memory.  Based in part on a patch from Mike Jetzer.

2003-08-14  Jim Meyering  <jim@meyering.net>
	and Paul Eggert  <eggert@twinsun.com>

	Merges from coreutils, plus other fixes.
	* physmem.c: Merge in portability changes from gcc/libiberty
	to support AIX, IRIX, Tru64, and Windows.  See the ChangeLog there
	for credits and details.  Thanks to Kaveh Ghazi for helping
	to keep these files in sync.
	(ARRAY_SIZE): Define it.
	(physmem_total, physmem_available): Add comments. From Kaveh Ghazi.
	* memcasecmp.c: Remove unnecessary parentheses after 'defined'.
	(memcasecmp): Don't assume size_t fits in unsigned int.
	Remove casts and duplicate code.
	* md5.c: Include <string.h> and <stdlib.h> unconditionally.
	(memcpy): Remove definition.
	Merge in some clean-up and optimization changes from glibc.
	[BLOCKSIZE]: Move definition to top of file.
	Ensure that it is a multiple of 64.
	Rearrange loop exit tests so as to avoid performing an
	additional fread after encountering an error or EOF.
	* md5.h (md5_uintptr): Define.
	* makepath.c (CLEANUP_CWD): Report an error if we failed to
	return to the initial working directory.  Preserve errno
	for caller.
	* idcache.c: Include "xalloc.h".
	(xmalloc, xrealloc): Remove decls.
	(getuser): Remove casts no longer required in C89.
	* human.c: Include stdio.h, for sprintf.
	* group-member.c: Include "xalloc.h".
	(xmalloc, xrealloc): Remove decls.
	(get_group_info): Remove casts no longer required in C89.
	* getusershell.c (readname): Remove casts no longer required in C89.
	* gettimeofday.c (rpl_gmtime, rpl_tzset): New functions.
	* getline.c: Whitespace fix, from coreutils.

2003-08-13  Paul Eggert  <eggert@twinsun.com>

	* exclude.c: Include <ctype.h>
	(IN_CTYPE_DOMAIN): New macro.
	(is_space): New fn.
	(add_exclude_file): If LINE_END is a space, ignore trailing spaces
	and empty lines.

	* argp-help.c, argp-parse.c, config.charset, getopt.h:
	Undo previous (whitespace-only) change.

2003-08-12  Paul Eggert  <eggert@twinsun.com>

	* argp-help.c, argp-parse.c, config.charset, getopt.h:
	Normalize leading white space and remove trailing white space.
	* ref-add.sin, ref-del.sin: Use '#' before empty line in copyright
	notice, as per ../config/srclist-update.

	Merge from coreutils.
	* euidaccess.h: New file.
	* euidaccess.c: Include it.
	* .cppi-disable: Add printf-args.h, printf-parse.h, stdbool_.h,
	vasnprintf.h, vasprintf.h.  Remove strdup.c, gettext.h.
	* regex.h, strdup.c, strtoll.c, strtoul.c: Normalize white space.

2003-08-11  Bruno Haible  <bruno@clisp.org>

	* vasnprintf.c (local_wcslen): New function, for Solaris 2.5.1.
	(vasnprintf): Use it instead of wcslen.

2003-08-11  Bruno Haible  <bruno@clisp.org>

	* stdbool_.h (_Bool): Undo last change; instead use a negative enum
	value to ensure that _Bool promotes to int. Use #define for _Bool when
	using the Solaris C compiler. Adds comments suggested by Paul Eggert.

2003-08-10  Karl Berry  <karl@gnu.org>

	* regex.h: update from libc (whitespace fix).

2003-08-09  Paul Eggert  <eggert@twinsun.com>

	Merge some files from coreutils.  These changes were
	originally made by Jim Meyering.
	* lib/acl.c: Include <sys/types.h> before <sys/stat.h>;
	many older Unixes require this.
	* lib/alloca.c (alloca): Remove cast to argument of free;
	no longer needed in C89.
	* lib/alloca_.h, lib/regex.h: Fix white space to match
	what GNU indent does.

2003-08-05  Paul Eggert  <eggert@twinsun.com>

	* bumpalloc.h: Remove.

2003-08-04  Paul Eggert  <eggert@twinsun.com>

	* getloadavg.c: Change copyright notice and spacing to conform to
	GNU coding style.

	Merge from coreutils.
	* error.c [!USE_IN_LIBIO]: Omit this case; assume USE_IN_LIBIO is 1.
	From glibc.
	* getdate.y (date): Also accept dates like May-23-2003; suggestion
	from Karl Berry, implemented by Jim Meyering.
	* getgroups.c: Include "xalloc.h" instead of declaring xalloc fns;
	from Dmitry V. Levin.
	Remove anachronistic cast of xrealloc.
	* fnmatch_.h (__const): Remove.  Use 'const'.
	* fnmatch_loop.c (NEW_PATTERN): Cast alloca return value to proper
	type. Otherwise, it wouldn't compile with at least /bin/cc on
	ymp-cray-unicos9.0.2.X.
	Combine two mostly-identical uses of alloca into one.
	Thanks to the Cray-Cyber project for access to a Cray Y-MP.

2003-08-04  Dave Love <d.love@dl.ac.uk>

	[From Emacs.]

	* getloadavg.c: Check `__unix' as well as `unix'.  Use #ifdef, not
	#if.  Check HAVE_LIBKSTAT as well as LOAD_AVE_TYPE.  Check
	F_SETFD, not FD_SETFD.  Use HAVE_STRUCT_NLIST_N_UN_N_NAME, not
	obsolete NLIST_NAME_UNION.
	[__GNU__]: Undef BSD and FSCALE.
	[!NLIST_STRUCT]: Remove conditional definition of NLIST_STRUCT.

2003-08-03  Paul Eggert  <eggert@twinsun.com>

	* stdbool_.h (_Bool): Make it signed char, instead of
	an enum type, so that it's guaranteed to promote to int.  See:
	<http://mail.gnu.org/archive/html/bug-gnulib/2003-07/msg00124.html>

2003-07-31  Paul Eggert  <eggert@twinsun.com>

	* strerror.c: Include config.h, limits.h.  Declare sprintf.
	(strerror): Don't assume that a printable int fits in 14 bytes.

2003-07-24  Derek Robert Price  <derek@ximbiot.com>
	    Bruno Haible  <bruno@clisp.org>

	* getline.h (getline, getdelim): Change return type to ssize_t.
	* getline.c (getline, getdelim): Likewise.
	Remove _GNU_SOURCE define; now it's defined in config.h through
	m4/getline.m4.

2003-07-22  Paul Eggert  <eggert@twinsun.com>

	* xalloc.h (XCALLOC, XREALLOC, CCLONE): Fix under- and
	over-parenthesization in macros.

	Sync with coreutils.

	* xalloc.h (XMALLOC, XCALLOC, XREALLOC): Remove casts not
	required by C99.

	Use `exit_failure' for xalloc and xmemcoll instead of their own
	private exit-failure variables.
	* xalloc.h (xalloc_exit_failure): Remove.
	* xmalloc.c: Likewise.  Include exitfail.h.
	(xalloc_die): Use exit_failure instead of xalloc_exit_failure.
	* xmemcoll.h (xmemcoll_exit_failure): Remove.
	* xmemcoll.c: Likewise.  Include exitfail.h.
	(xmemcoll): Use exit_failure instead of xalloc_exit_failure.

2003-07-18  Paul Eggert  <eggert@twinsun.com>

	* closeout.h (close_stdout_set_status, close_stdout_status): Remove.
	* closeout.c: Likewise.  Include "closeout.h" right after config.h,
	to test that it can stand by itself.  Include "exitfail.h".
	Clients should set exit_failure instead.
	(EXIT_FAILURE): Remove; no longer needed.  Do not include <stdlib.h>.

2003-07-18  Andreas Schwab  <schwab@suse.de>

	* memcoll.c (memcoll) [!HAVE_STRCOLL]: Clear errno.

2003-07-18  Bruno Haible  <bruno@clisp.org>

	* getndelim2.h: New file.
	* getndelim2.c: Make into a module of its own. Include config.h,
	getndelim2.h.
	(getndelim2): Make non-static. Change return type to ssize_t.
	* getline.h: Change argument names.
	* getline.c: Include getndelim2.h instead of getndelim2.c.
	* getnline.c: Include getndelim2.h.

2003-07-17  Bruno Haible  <bruno@clisp.org>

	* Makefile.am: Remove file.
	* Makefile.in: Remove file.

2003-07-17  Bruno Haible  <bruno@clisp.org>

	* getnline.h: New file.
	* getnline.c: New file.
	* getndelim2.c: New file, extracted from getline.c.
	(getndelim2): Renamed from getdelim2, with added nmax argument.
	* getline.c: Include getndelim2.c.
	(getdelim2): Moved out to getndelim2.c.
	(getline, getdelim): Update.

2003-07-15    <karl@gnu.org>

	* vasnprintf.c: update from gettext.

2003-07-15  Jim Meyering  <jim@meyering.net>

	* makepath.c (make_path): Enclose diagnostic in _(...).

2003-07-14  Paul Eggert  <eggert@twinsun.com>

	* asnprintf.c, asprintf.c, config.charset, gettext.h,
	localcharset.c, localcharset.h, mkdtemp.c, printf-args.c,
	printf-args.h, printf-parse.c, printf-parse.h, ref-add.sin,
	ref-del.sin, setenv.c, unsetenv.c, vasnprintf.c, vasnprintf.h,
	vasprintf.c, vasprintf.h: Regenerate.  These files are now being
	updated automatically by ../config/srclist-update.  This changes
	their license from LPGL to GPL.

2003-07-14  Jim Meyering  <jim@meyering.net>

	Don't emit diagnostics.  Let callers do that.
	* save-cwd.c: Don't include "error.h".
	(save_cwd): Don't call error.  Ensure that errno is valid
	when returning nonzero.

	* save-cwd.h (restore_cwd): Update prototype.
	* save-cwd.c (restore_cwd): Remove two parameters.
	Simplify.  Don't call error upon failure.  Let callers do that.
	(save_cwd): Mention that Irix 5.3 has the same problem as SunOS 4
	when auditing is enabled.  But don't bother updating the #if.

2003-07-14  Simon Josefsson  <jas@extundo.com>

	* mempcpy.h: New file.
	* mempcpy.c: New file.

2003-07-14  Paul Eggert  <eggert@twinsun.com>

	* ceill.c, expl.c, floorl.c, frexpl.c, ldexpl.c, mathl.h,
	sincosl.c, sqrtl.c, trigl.c, trigl.h, poll.c, poll_.h, mkstemp.c,
	unicodeio.c, unicodeio.h, unlocked-io.h:
	Switch from LGPL to GPL.

2003-07-11  Alexandre Duret-Lutz  <adl@gnu.org>

	* obstack.h (__INT_TO_PTR): Revert change of 2003-03-13;
	it breaks C++ compilation.
	[!__GNUC__ || !__STDC__] (obstack_finish): Cast result to void*.

2003-07-10  Jim Meyering  <jim@meyering.net>

	* vasnprintf.c: Remove trailing blanks.
	Make cpp indentation consistent.

2003-07-09  Paul Eggert  <eggert@twinsun.com>

	* alloca_.h, euidaccess.c, getpass.c, memrchr.c, obstack.h,
	posixver.c, strftime.c, strnlen.c, strverscmp.c:
	Switch from LGPL to GPL.

2003-07-07  Paul Eggert  <eggert@twinsun.com>

	* mktime.c: Fix some boundary cases and remove need for floating point.

	Issue a compile-time diagnostic if time_t is floating point, or if
	two's complement arithmetic is not in effect, or if arithmetic
	right shift does not propagate the sign.  These assumptions were
	all in the original code but they weren't checked.

	(TIME_T_MIDPOINT, verify): New macros.
	(__isleap): Remove; it has integer overflow problems.
	(leapyear): New function, without those problems.
	(ydhms_tm_diff): Remove; splitting into two parts.
	(ydhms_diff): New function, containing the arithmetic part of
	the old ydhms_tm_diff function.  Issue a compile-time
	diagnostic if we are not using C99 integer division.
	Avoid casts when possible.
	(guess_time_tm): New function, containing the checking part of
	the old ydhms_tm_diff function.  Return the new value, rather than
	the difference between it and the old.  Accept a new argument T
	so that *T specifies the old value.  Check for overflow in the result.

	(__mktime_internal): Use a time_t offset, not a long int offset.
	This undoes the 2003-06-04 change, which is no longer needed now
	that we have better overflow checking.
	(localtime_offset): Likewise.

	(__mktime_internal): Avoid harmful overflow on hosts where time_t
	and long are 64-bit but int is only 32-bit.
	(ydhms_diff): Use long int to store year1 and yday1.
	Issue a compile-time diagnostic if long int is not wide enough.

	(__mktime_internal): Use long int to store adjusted year and yday.
	Use plain C rather than preprocessor commands, if that doesn't
	affect efficiency.
	Check for overflow (and try to repair) after each probe
	rather than checking only at the very end.  This avoids some bugs
	(e.g., southern hemisphere, behind GMT, and GMT offset at minimum time
	does not equal GMT offset at maximum time).
	Use integer to check for overflow rather than floating point; this
	is more portable to non-IEEE hosts, and is a tad faster.
	When we detect that we are oscillating between two values,
	don't check whether tm_isdst has the requested value, since
	we already know the answer.  When tm_isdst has the wrong value,
	use a different heuristic to find the right one, based on the
	extreme values actually observed in practice in tz2003a,
	rather than the (overly optimistic) "previous 3 calendar quarters".

	(not_equal_tm, print_tm, check_result): Use "const T" rather than
	"T const" to accommodate glibc style.
	(check_result): Use less-confusing report format.  "long" -> "long int.
	(main): Likewise.
	Don't loop if the iteration overflows time_t.
	Allow a negative step in the iteration.

2003-07-01  Paul Eggert  <eggert@twinsun.com>

	* xreadlink.c: Include <sys/types.h> unconditionally, instead of
	having it depend on HAVE_SYS_TYPES_H.

2003-06-25  Bruno Haible  <bruno@clisp.org>

	* readlink.c: New file.

2003-06-20  Bruno Haible  <bruno@clisp.org>

	Assume C89, so PARAMS isn't needed.
	* unicodeio.h (PARAMS): Remove.
	* unicodeio.c: Don't use PARAMS.

2003-06-18  Jim Meyering  <jim@meyering.net>

	Merge changes from coreutils.
	* readutmp.c: Include <string.h> and <stdlib.h> unconditionally.
	Remove explicit declarations of xmalloc and realloc.
	Include xalloc.h.
	(read_utmp): Remove anachronistic cast of xmalloc.

2003-06-17  Paul Eggert  <eggert@twinsun.com>

	Assume C89, so PARAMS isn't needed.
	* backupfile.h (PARAMS): Remove.  All uses removed.
	* closeout.h, dirname.h, filemode.h, fsusage.h, getdate.h, getline.h,
	group-member.h, hard-locale.h, hash.h, linebuffer.h, long-options.h,
	makepath.h, memcasecmp.h, memcoll.h, modechange.h, mountlist.h,
	path-concat.h, physmem.h, posixtm.h, quote.h, readutmp.h, same.h,
	save-cwd.h, savedir.h, stdio-safer.h, strtoimax.c, strverscmp.h,
	unistd-safer.h, version-etc.h, xalloc.h, xreadlink.h, xstrtod.h,
	xstrtol.h: Likewise.
	* filemode.h, hard-locale.h, memcoll.h, modechange.h, physmem.h,
	same.h, strverscmp.h: Do not include config.h; no longer needed.
	Anyway, config.h should always be included before any other file.

2003-06-11  Simon Josefsson  <jas@extundo.com>

	* sysexit_.h: New file.

2003-05-20  Derek Price  <derek@ximbiot.com>

	* stat.c [LSTAT]: Compile/use slash_aware_lstat only if it is necessary.

2003-06-10  Simon Josefsson  <jas@extundo.com>

	* strchrnul.h: New file.
	* strchrnul.c: New file.

2003-06-10  Simon Josefsson <jas@extundo.com>

	* argp.h: New file, from glibc.
	* argp-ba.c: New file, from glibc.
	* argp-eexst.c: New file, from glibc.
	* argp-fmtstream.c: New file, from glibc.
	* argp-fmtstream.h: New file, from glibc.
	* argp-fs-xinl.c: New file, from glibc.
	* argp-help.c: New file, from glibc.
	* argp-namefrob.h: New file, from glibc.
	* argp-parse.c: New file, from glibc.
	* argp-pv.c: New file, from glibc.
	* argp-pvh.c: New file, from glibc.
	* argp-xinl.c: New file, from glibc.

2003-06-07  Jim Meyering  <jim@meyering.net>

	* readtokens.h: Put `Free Software Foundation, Inc.'
	in place of my name in the copyright comment.
	Remove definition and uses of __P.

	From coreutils.
	* stat.c: Don't declare xmalloc explicitly.
	Instead, include "xalloc.h".
	* readtokens.c (readtokens): Remove anachronistic casts of xmalloc,
	xrealloc, and xcalloc return values.
	* xgetcwd.c (xgetcwd): Include "xgetcwd.h".
	Improve comment.
	* xgetcwd.h: Remove definition/uses of PARAMS.

2003-06-06  Jim Meyering  <jim@meyering.net>

	* stdbool_.h: Renamed from stdbool.h.in.

2003-06-06  Jim Meyering  <jim@meyering.net>

	Merge from coreutils.
	* same.c: (same_name): Declare *_basename locals to be `const'.
	Consolidate declarations and initializations of *_base* locals.

	Merge from coreutils.
	This avoids a core dump on systems without GNU putenv,
	when running `env -u SOME_ALREADY_UNSET_VARIABLE'.
	* putenv.c (__set_errno, LOCK, UNLOCK): Define.
	(unsetenv): New static function, from GNU libc.
	(rpl_putenv): Use it.

	* modechange.c: Remove trailing blanks.

	Merge from coreutils.
	* fsusage.c: Remove declaration of statfs.
	It conflicted with one from OSF/1 5.1 in <sys/mount.h>.

	* posixtm.c: Include <stdbool.h> unconditionally.

2003-06-05  Paul Eggert  <eggert@twinsun.com>

	* mktime.c (__mktime_internal): When resolving a tm_isdst
	mismatch, look in future quarters as well as past.  This fixes a
	bug when processing fall-backwards gaps immediately after a long
	period of daylight-saving time.

	* mktime.c: Assume freestanding C89 or better.
	(HAVE_LIMITS_H): Remove.  Assume it's 1.
	(__P): Remove; not used.
	(CHAR_BIT, INT_MIN, INT_MAX): Remove; <limits.h> defines them.
	(mktime, not_equal_tm, print_tm, check_result,
	main): Use prototypes.  Use const * where appropriate.
	(main): Fix typo in testing code that uncovered by above changes.
	(Local Variables): Remove -DHAVE_LIMITS_H from compile-command.

2003-06-04  Paul Eggert  <eggert@twinsun.com>

	* mktime.c: Fix Debian bug 177940
	<http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=177940>.
	(localtime_offset): Now long int, not time_t, because we want it
	to be guaranteed to be signed.  All uses changed.
	(__mktime_internal): If overflow would occur when adding offset,
	don't add it.

	Merge 'human' changes from coreutils.  Rewrite to support
	locale-specific notations like thousands separators.
	* human.c: Simplify authorship notice.
	Include human.h immediately after config.h.
	<sys/types.h>, <stdio.h>: Do not include; no longer needed.
	<limits.h>: Do not include, since human.h does.
	(SIZE_MAX, UINTMAX_MAX): New macros.
	<strings.h>: Include if HAVE_STRINGS_H, not if !HAVE_STRING_H.
	<locale.h>: Include if HAVE_LOCALE_H and HAVE_LOCALECONV.
	(HUMAN_READABLE_SUFFIX_LENGTH_MAX): New macro.
	(power_letter): Renamed from suffixes.
	(generate_suffix_backwards): Remove.
	(adjust_value): Now takes int style (because of human.h changes)
	and long double value (for greater precision on some platforms).
	(group_number): New function.
	(human_readable): Use it.  Use integer options, not enum.
	Put the options before the sizes in the arg list.
	Support all the new options.
	The old human_readable function has been removed;
	use inttostr.h instead.
	(human_readable, default_block_size, humblock):
	Use uintmax_t, not int, for block sizes.
	(human_readable_inexact, block_size_types): Remove.
	(block_size_opts): New constant.
	(human_options): Renamed from human_block_size, with new signature
	that allows block sizes up to UINTMAX_MAX.  All callers changed.
	* human.h: Add copyright and authorship notice.
	Include <limits.h> and <stdbool.h> unconditionally.
	(PARAMS): Remove.  All uses removed.
	(LONGEST_HUMAN_READABLE): Add support for thousands separator.
	(enum human_inexact_style): Remove tag; now a nameless enum.
	(human_floor, human_ceiling, human_round_to_even): Now have
	values 2, 0, 1 rather than -1, 1, 0.
	(human_group_digits, human_suppress_point_zero, human_autoscale,
	human_base_1024, human_SI, human_B): New constants.
	(human_readable_inexact, human_block_size): Remove.
	(human_readable): Size args are now uintmax_t, not int.
	(human_options): New decl.

	* exclude.c: (new_exclude, add_exclude): Remove casts that are
	unnecessary now that we assume C89 or better.  This change
	imported from coreutils.

	* mktime.c (__mktime_internal): Do not reject negative timestamps
	arbitrarily.  This is the same patch as 2003-05-28, but it got lost
	in the 2003-05-30 sync from glibc.

	.h files should stand alone, but we shouldn't include <sys/types.h>
	if we can get away with just <stddef.h>.

	* __fpending.h, addext.c, backupfile.c, exclude.c, getline.c,
	malloc.c, putenv.c, realloc.c, strcasecmp.c: Include <stddef.h>
	rather than <sys/types.h>, as we merely need size_t.
	* dirname.h, memcoll.h, xalloc.h, xmemcoll.h: Include <stddef.h>,
	to get size_t.
	* hash.h, linebuffer.h, readtokens.h, stdio-safer.h, version-etc.h:
	Include <stdio.h>, to get FILE.
	* memcasecmp.c: Don't include <sys/types.h>, as we can assume
	memcasecmp.h has included <stddef.h> and all we need is size_t.
	* memcoll.c: Include "memcoll.h", which gets us size_t and checks
	our interface, instead of including <sys/types.h>

2003-06-02  Paul Eggert  <eggert@twinsun.com>

	[from coreutils]
	Fix some minor time-related bugs with POSIX time arguments.
	Some valid time stamps were being rejected (notably -1, and
	time stamps before 1900 on 64-bit hosts).  And some invalid
	time stamps were being accepted, e.g. September 31.

	* posixtm.h (posixtime): Return bool instead of time_t, so
	that we can return (time_t) -1 successfully.
	* posixtm.c: Likewise.
	[HAVE_STDBOOL_H]: Include <stdbool.h>.
	(bool, false, true) [!HAVE_STDBOOL_H]: New type.
	(t): Remove static var.
	(year, posix_time_parse): Now takes struct tm * arg to modify, instead
	of static var.  All uses changed.
	(year): Do not reject years before 1900; they can occur with
	64-bit time_t.
	(posix_time_parse): Do not check for out-of-range components;
	that is now the caller's responsibility, since our checks were
	only approximations.
	(posixtime): Use mktime to check for out-of-range components,
	since it knows them exactly.
	If mktime returns (time_t) -1, check whether an error actually occurred
	by invoking localtime on -1.
	(main) [TEST_POSIXTIME]: Check for input data errors, and report
	posixtime failures better.
	Improve the test data (in comments only).

2003-05-30    <karl@gnu.org>

	* mktime.c: update from libc.

2003-05-30  Bruno Haible  <bruno@clisp.org>

	* config.charset: Upgrade to gettext-0.12.1 and libiconv-1.9.1.
	* localcharset.h: Likewise.
	* localcharset.c: Likewise.

2003-05-28  Paul Eggert  <eggert@twinsun.com>

	Assume the headers required for C89 freestanding compilers.
	* addext.c, backupfile.c, fsusage.c, human.c, pathmax.h,
	rpmatch.c, userspec.c, xreadlink.c, xstrtol.c: Include <limits.h>
	without checking for HAVE_LIMITS_H.
	* backupfile.c, fsusage.c, hash.c, human.c, safe-read.c, userspec.c,
	xstrtol.c (CHAR_BIT) : Don't define, since <limits.h> is guaranteed
	to do that.
	* fatal.c: Include <stdarg.h> without checking for __STDC__.
	* exclude.c: Include <stdbool.h> unconditionally.
	* tempname.c: Include <stddef.h> unconditionally.
	* hash.c: Include <limits.h>, since we no longer define CHAR_BIT.
	* modechange.c, rpmatch.c (NULL): Don't define, since
	<stddef.h> does that.
	* quote.c: Dont include <stddef.h> or <sys/types.h>; not needed.
	* safe-read.c (INT_MAX): Don't define, since <limits.h> does that.
	* safe-read.c (TYPE_MINIMUM, TYPE_MAXIMUM): Remove; no longer needed.
	* xstrtol.c: Likewise.
	* safe-read.c: Remove TYPE_SIGNED; no longer needed.
	* savedir.c: Include <stddef.h> instead of defining NULL.

	* addext.c (addext): Use assignment rather than cast, to avoid
	warnings on some platforms.

	* mktime.c (__mktime_internal): Do not reject negative timestamps
	arbitrarily.

2003-05-10  Bruno Haible  <bruno@clisp.org>

	* linebreak.c (iconv_string_length): Don't return -1 just because the
	string is longer than 4 KB.

2003-05-12  Jim Meyering  <jim@meyering.net>

	* strftime.c (my_strftime): Let the `-' (no-pad) flag affect
	the space-padded-by-default conversion specifiers, %e, %k, %l.

2003-05-03  Bruno Haible  <bruno@clisp.org>

	Upgrade to Unicode-4.0.
	* linebreak.c (nonspacing_table_data): Change width of U+00AD,
	U+0350..U+0357, U+035D..U+035F, U+0600..U+0603, U+0610..U+0615,
	U+0656..U+0658, U+0A01, U+0AE2..U+0AE3, U+0CBC, U+17B4..U+17B5,
	U+17DD, U+1920..U+1922, U+1927..U+192B, U+1932, U+1939..U+193B
	from 1 to 0. Change width of U+0CBF, U+0CC6, U+180E from 0 to 1.
	(uc_width): Change width of U+4DC0..U+4DFF from 2 to 1. Change width
	of U+2A6D7..U+2F7FF, U+2FA1E..U+2FFFD, U+30000..U+3FFFD from 1 to 2.
	Change width of U+E0100..U+E01EF from 1 to 0.

2003-04-25  Bruno Haible  <bruno@clisp.org>

	* copy-file.c: Include <stddef.h>, for size_t.

2003-04-25  Jim Meyering  <jim@meyering.net>

	* copy-file.c (copy_file_preserving): Declare buf_size to be
	of type size_t, not int.

2003-04-11  Jim Meyering  <jim@meyering.net>

	Merge changes from Coreutils.

	2003-03-22  Jim Meyering  <jim@meyering.net>

	* strftime.c (widen): Cast alloca return value to proper type.

	2003-01-19  Ulrich Drepper  <drepper@redhat.com>

	From GNU libc.
	* strftime.c (my_strftime): Handle very large width
	specifications for numeric values correctly.  Improve checks for
	overflow.

	2003-01-19  Jim Meyering  <jim@meyering.net>

	* strftime.c (widen) [COMPILE_WIDE]: Merge nearly-identical definitions.
	(nl_get_alt_digit) [! defined my_strftime]: Define.
	(my_strftime) [_NL_CURRENT]: Merge nearly-identical uses of
	_nl_get_alt_digit and _nl_get_walt_digit.

	* strftime.c (my_strftime): Merge in locale-related changes from libc.
	These changes have no effect outside of _LIBC.

2003-04-10  Bruno Haible  <bruno@clisp.org>

	* findprog.h: New file, from GNU gettext.
	* findprog.c: New file, from GNU gettext.

2003-04-05  Jim Meyering  <jim@meyering.net>

	Merge changes from Coreutils.

	* exclude.h (PARAMS): Remove definition and uses.
	* exclude.c: Remove uses of `PARAMS'.

	* dirname.c [TEST_DIRNAME]: Update build instructions for test.
	Add test-cases for DOS filenames. Declare program_name.
	(main): Set up program_name.  Patch by Rich Dawe.

	* mountlist.c (read_filesystem_list) [MOUNTED_VMOUNT]: Detect any
	error from mntctl.
	Use mntctl's return value to drive the entry-processing loop, since
	we can't rely on the value of the vmt_length member in the last
	entry.  On some systems doing so could result in exhausting
	virtual memory.  Based in part on a patch from Mike Jetzer.

2003-04-04  Bruno Haible  <bruno@clisp.org>

	* linebreak.h: New file, from GNU gettext.
	* linebreak.c: New file, from GNU gettext with slight modifications.
	* lbrkprop.h: New file, from GNU gettext.

2003-04-03  Bruno Haible  <bruno@clisp.org>

	* utf8-ucs4.h: New file, from GNU gettext.
	* utf16-ucs4.h: New file, from GNU gettext.
	* ucs4-utf8.h: New file, from GNU gettext.
	* ucs4-utf16.h: New file, from GNU gettext.

2003-04-02  Bruno Haible  <bruno@clisp.org>

	* binary-io.h: New file, from GNU gettext.

2003-04-01  Bruno Haible  <bruno@clisp.org>

	* pathname.h: New file, from GNU gettext.
	* concatpath.c: New file, from GNU gettext.

2003-03-30  Bruno Haible  <bruno@clisp.org>

	* copy-file.c (copy_file_preserving): Don't set owner if the function
	chown() doesn't exist.

2003-03-28  Bruno Haible  <bruno@clisp.org>

	* copy-file.h: New file, from GNU gettext.
	* copy-file.c: New file, from GNU gettext.

2003-03-18  Jim Meyering  <jim@meyering.net>

	* quote.c (quote_n): Fix typo in comment.

2003-03-14  Jim Meyering  <jim@meyering.net>

	Merge changes from Coreutils.
	* obstack.h (obstack_object_size): Declare temporary, __o,
	to be const, in order to avoid warnings.
	(obstack_room): Likewise.
	(obstack_empty_p): Likewise.

2003-03-13  Paul Eggert  <eggert@twinsun.com>

	Merge changes from Bison.
	* obstack.h: (__INT_TO_PTR) [__STDC__]: Cast result to
	(void *) to avoid diagnostic with native c89 on SGI IRIX 6.5
	when compiling Bison 1.875's `bitset bset = obstack_alloc
	(bobstack, bytes);'.  Problem reported by Nelson H. F. Beebe.
	* hash.c: Include <stdbool.h> unconditionally.

2003-03-09  Paul Eggert  <eggert@twinsun.com>

	* argmatch.c (EXIT_FAILURE): Define if the system doesn't.
	Reported by Bruce Becker; see:
	http://mail.gnu.org/archive/html/bug-bison/2003-03/msg00017.html

2003-03-03  Paul Eggert  <eggert@twinsun.com>
	    Bruno Haible  <bruno@clisp.org>

	* mbswidth.h: Include <wchar.h>. Needed for UnixWare 7.1.1.
	Reported by John Hughes, see
	http://mail.gnu.org/archive/html/bug-bison/2003-02/msg00030.html

2003-02-19  Paolo Bonzino  <bonzini@gnu.org>

	* poll_.h: New file.
	* poll.c: New file.

2003-02-18  Paolo Bonzino  <bonzini@gnu.org>

	* mathl.h: New file.
	* acosl.c: New file.
	* asinl.c: New file.
	* atanl.c: New file.
	* ceill.c: New file.
	* cosl.c: New file.
	* expl.c: New file.
	* floorl.c: New file.
	* frexpl.c: New file.
	* ldexpl.c: New file.
	* logl.c: New file.
	* sincosl.c: New file.
	* sinl.c: New file.
	* sqrtl.c: New file.
	* tanl.c: New file.
	* trigl.c: New file.
	* trigl.h: New file.

2003-02-17  Bruno Haible  <bruno@clisp.org>

	* mkdtemp.h: New file, from GNU gettext.
	* mkdtemp.c: New file, from GNU gettext.

2003-01-31  Bruno Haible  <bruno@clisp.org>

	* rename.c: #undef rename before defining rpl_rename.
	* strnlen.c: #undef strnlen, define rpl_strnlen instead of strnlen.

2003-01-30  Bruno Haible  <bruno@clisp.org>

	* printf-args.h: New file, from GNU gettext.
	* printf-args.c: New file, from GNU gettext.
	* printf-parse.h: New file, from GNU gettext.
	* printf-parse.c: New file, from GNU gettext.
	* vasnprintf.h: New file, from GNU gettext.
	* vasnprintf.c: New file, from GNU gettext.
	* asnprintf.c: New file, from GNU gettext.
	* vasprintf.h: New file, from GNU gettext with modifications.
	* vasprintf.c: New file, from GNU gettext.
	* asprintf.c: New file, from GNU gettext.

2003-01-29  Bruno Haible  <bruno@clisp.org>

	* stpncpy.h: New file, from GNU gettext with modifications.
	* stpncpy.c: New file, from GNU gettext with modifications.

2003-01-28  Bruno Haible  <bruno@clisp.org>

	* c-ctype.h: New file, from GNU gettext, with changes suggested by
	Paul Eggert.
	* c-ctype.c: New file, from GNU gettext, with changes suggested by
	Paul Eggert.

2003-01-27  Bruno Haible  <bruno@clisp.org>

	* xsetenv.h: New file, from GNU gettext.
	* xsetenv.c: New file, from GNU gettext.

2003-01-23  Bruno Haible  <bruno@clisp.org>

	* minmax.h: New file, from GNU gettext, with comments from Paul Eggert.

2003-01-22  Bruno Haible  <bruno@clisp.org>

	* exit.h: New file, from GNU gettext.

2003-01-11  Bruno Haible  <bruno@clisp.org>

	* stpcpy.h (stpcpy): Use ANSI C function declarations.
	* strcase.h (strcasecmp, strncasecmp): Likewise.

2003-01-14  Jim Meyering  <jim@meyering.net>

	* same.c (same_name): Tweak a comment.

2003-01-11  Bruno Haible  <bruno@clisp.org>

	* same.c (same_name): Reorder tests so as to avoid calling stat()
	when a string comparison is sufficient.

2003-01-11  Bruno Haible  <bruno@clisp.org>

	* readtokens.c (readtoken): Cast character to 'unsigned char', not
	'unsigned int'.

2003-01-11  Bruno Haible  <bruno@clisp.org>

	* hash-pjw.c: Add comment about low quality of this function.

2003-01-12  Paul Eggert  <eggert@twinsun.com>

	Finish renaming getstr -> getdelim2 and readline -> readlinebuffer,
	to avoid collisions with libcurses and libreadline.

	* Makefile.am (libfetish_a_SOURCES): Remove getstr.c, getstr.h.
	* getstr.h, getstr.c: Remove.
	* getline.c: Include "getline.h", to check interface.
	Move body of old getstr.c here: this defines MIN_CHUNK and
	declares getdelim2, which is renamed from getstr.
	(getline, getdelim): Adjust to renaming of getstr -> getdelim2.

	* linebuffer.c (readlinebuffer): Renamed from readline.
	All uses changed.
	* linebuffer.h: Likewise.
	(readline): Remove backward-compatibility macro.

2003-01-12  Jim Meyering  <jim@meyering.net>

	* makepath.c: Don't test HAVE_ERRNO_H.  It's not necessary.

2003-01-10  Bruno Haible  <bruno@clisp.org>

	* alloca_.h: New file.
	* getdate.y: Unconditionally include alloca.h.
	* makepath.c: Likewise.
	* setenv.c: Likewise.
	* userspec.c: Likewise.

2003-01-09  Bruno Haible  <bruno@clisp.org>

	* stdbool.h.in: New file.

2003-01-08  Bruno Haible  <bruno@clisp.org>

	* safe-read.c: Include specification header first, to ensure its
	selfcontainedness.
	* full-write.c: Likewise.

2003-01-08  Jim Meyering  <jim@meyering.net>

	* full-write.c: Undefine and define-away `const' after inclusion
	of errno.h, not before.  Suggestion from Bruno Haible.

2003-01-07  Jim Meyering  <jim@meyering.net>

	* full-write.c: Rework so that it may serve to define full_read, too.
	* full-read.c: Simply #define FULL_READ and include full-write.c.

2003-01-06  Jim Meyering  <jim@meyering.net>

	* version-etc.c: Update year in translatable copyright string.

2002-12-25  Bruno Haible  <bruno@clisp.org>

	* strtoimax.c: Include <stdint.h> as an alternative to <inttypes.h>.
	* xstrtol.h: Likewise.
	* xstrtoimax.c: Likewise.
	* xstrtoumax.c: Likewise.
	* human.h: Likewise.

	* tempname.c: Include <inttypes.h> too. Avoids a compilation error
	on systems that have <inttypes.h> but not <stdint.h>.

2002-12-31  Paul Eggert  <eggert@twinsun.com>

	* memcoll.c (memcoll): Fall back on a simple algorithm using
	memcmp if strcoll doesn't work.

2002-12-23  Bruno Haible  <bruno@clisp.org>

	* localcharset.h: New file.
	* localcharset.c: Include it.
	* unicodeio.c: Likewise.

2002-12-22  Bruno Haible  <bruno@clisp.org>

	* utime.c (utime_null): No need to call ftruncate if the file was
	nonempty.

2002-12-23  Bruno Haible  <bruno@clisp.org>

	* memcoll.c (STRCOLL): New macro.
	(memcoll): Use it.

2002-12-22  Bruno Haible  <bruno@clisp.org>

	* getstr.h (getstr): Define, to avoid clash with libcurses.
	* linebuffer.h (readline): Define, to avoid clash with libreadline.

2002-12-22  Bruno Haible  <bruno@clisp.org>

	* getdate.y (get_date): Test HAVE_STRUCT_TM_TM_ZONE, not HAVE_TM_ZONE.

2002-12-23  Bruno Haible  <bruno@clisp.org>

	* getline.h: Include <stddef.h>, for size_t.

	* unicodeio.h: Include <stddef.h>, for size_t.
	* unicodeio.c: Don't include <stddef.h>.

2002-12-17  Bruno Haible  <bruno@clisp.org>

	* canon-host.c (strdup): Remove unused declaration.

	* fsusage.c: Include full_read.h.
	(get_fs_usage): Use full_read instead of safe_read.

	* utime.c (utime_null): Use SAFE_READ_ERROR.

2002-12-11  Bruno Haible  <bruno@clisp.org>

	* setenv.h: Rewritten to cope with systems that have setenv() but not
	unsetenv().
	* setenv.c, unsetenv.c: Taken from glibc-2.2.4 with the following
	modifications:

	2002-12-11  Bruno Haible  <bruno@clisp.org>

		* setenv.c (alloca): Fall back to malloc.
		(freea): New macro.
		(setenv): Use freea() to free memory allocated with alloca().

	2002-11-13  Bruno Haible  <bruno@clisp.org>

		* setenv.c (compar_fn_t, __add_to_environ, setenv): Use ANSI C
		function declarations.
		* unsetenv.c (unsetenv): Likewise.

	2002-03-04  Bruno Haible  <bruno@clisp.org>

		Portability to AIX 4.3.3.
		* unsetenv.c: New file, extracted from setenv.c.
		* setenv.c: Move the unsetenv() function to unsetenv.c.

	2001-12-20  Bruno Haible  <bruno@clisp.org>

		* setenv.c (__add_to_environ): Don't call realloc(NULL,...),
		use malloc instead. For SunOS 4.

	2001-12-11  Bruno Haible  <bruno@clisp.org>

		* setenv.c: Declare alloca.
		(compar_fn_t): New typedef.
		(KNOWN_VALUE, STORE_VALUE): Use it.

	* Makefile.am (libfetish_a_SOURCES): Add setenv.c, unsetenv.c,
	setenv.h.

2002-12-10  Paul Eggert  <eggert@twinsun.com>

	Port exclude.c and exclude.h to more non-GNU systems, e.g. Solaris 7.
	* exclude.h (EXCLUDE_ANCHORED, EXCLUDE_INCLUDE, EXCLUDE_WILDCARDS):
	Choose values that are less likely to collide with system fnmatch
	options.
	* exclude.c (FNM_CASEFOLD, FNM_LEADING_DIR): Define to 0 if not
	defined (e.g., a pure POSIX system).
	(EXCLUDE_macros_do_not_collide_with_FNM_macros): Use FNM_PATHNAME
	instead of FNM_FILE_NAME, for compatibility with pure POSIX sytems.

2002-12-06  Jim Meyering  <jim@meyering.net>

	* error.c: Be consistent: change `#ifndef _LIBC' to `#if !_LIBC'.

	Merge in changes from libc's misc/error.c, in preparation
	for the merge of gnulib's changes back into libc.

	* error.c (_): Define only if not already defined.
	Move definition to follow all #include directives.
	Include unlocked-io.h only if !_LIBC.
	[_LIBC]: Include <libio/libioP.h>.
	[USE_IN_LIBIO]: Include <libio/iolibio.h>
	(fflush): Tweak definition to use INTUSE.
	(putc): Define.

2002-12-05  Paul Eggert  <eggert@twinsun.com>

	* alloca.c [defined emacs]: Include "lisp.h".
	(xalloc_die) [defined emacs]: New macro.
	(free) [defined emacs && defined EMACS_FREE]: Define to EMACS_FREE.
	[! defined emacs]: Include <xalloc.h>.
	(POINTER_TYPE) [!defined POINTER_TYPE]: New macro.
	(pointer): Typedef to POINTER_TYPE *.
	(malloc): Remove decl; we now always use xmalloc.
	(alloca): Use old-style definition, since Emacs needs this.
	Check for arithmetic overflow when computing combined size.

2002-12-04  Paul Eggert  <eggert@twinsun.com>

	Do not generate unlocked-io.h automatically, since it's easier to
	maintain it by hand.

	* unlocked-io.h: New file, from GNU diffutils,
	but with proper copyright notice and attribution.
	* gen-uio: Remove.
	* Makefile.am: Add copyright notice.
	(libfetish_a_SOURCES): Add unlocked-io.h.
	(BUILT_SOURCES, all-local): Remove unlocked-io.h.
	(DISTCLEANFILES, io_functions): Remove macros.
	(EXTRA_DIST): Remove gen_uio.
	(unlocked-io.h): Remove rule.

2002-12-04  Jim Meyering  <jim@meyering.net>

	Reflect the fact that stat.c and lstat.c are no longer generated.
	* Makefile.am (BUILT_SOURCES): Remove stat.c and lstat.c.
	(DISTCLEANFILES): Likewise.
	(EXTRA_DIST): Likewise.
	(all_local): Don't depend on stat.c or lstat.c.
	(stat.c, lstat.c): Remove rules.
	(EXTRA_DIST): Remove xstat.in.

	* xstat.in: Remove file.  Contents moved into stat.c.
	* stat.c: New file.  Contents mostly from xstat.in.
	* stat.c: Rework so that it may serve to define rpl_lstat, too.
	* lstat.c: New file. Simply #define LSTAT and include stat.c.

	* safe-read.c: Rework so that it may serve to define safe_write, too.
	* safe-write.c: Simply #define SAFE_WRITE and include safe-read.c.

2002-12-03  Jim Meyering  <jim@meyering.net>

	* safe-read.c, safe-write.c: Change variable names and comments, but
	not semantics, to minimize the differences between these two files.
	(safe_read): Change comment to mention SAFE_READ_ERROR.

	* safe-read.c (IS_EINTR): Define.
	(safe_read): Use IS_EINTR in place of in-function cpp directives.

2002-12-02  Bruno Haible  <bruno@clisp.org>

	* safe-write.c (CHAR_BIT, TYPE_SIGNED, TYPE_MINIMUM, TYPE_MAXIMUM):
	Define, taken from safe-read.c.
	(INT_MAX): Provide fallback.
	(safe_write): Rewrite to iterate IFF the write fails with EINTR.
	* safe-write.h (SAFE_WRITE_ERROR): Define.

	* safe-read.c (EINTR): Remove definition.
	(safe_read): Don't use EINTR if it is absent.

2002-12-02  Jim Meyering  <jim@meyering.net>

	* safe-read.c (EINTR): Define.
	(CHAR_BIT, TYPE_SIGNED, TYPE_MINIMUM, TYPE_MAXIMUM): Define.
	(INT_MAX): Provide fallback.
	(safe_read): Rewrite to iterate IFF the read fails with EINTR.

	* safe-read.h (SAFE_READ_ERROR): Define.

2002-12-01  Jim Meyering  <jim@meyering.net>

	* safe-read.c: (safe_read): Also exit the loop when read returns zero.
	(CHAR_BIT, TYPE_SIGNED, TYPE_MINIMUM, TYPE_MAXIMUM, INT_MAX): Define.

2002-11-27  Paul Eggert  <eggert@twinsun.com>

	* hash.c (hash_lookup, hash_get_first, hash_get_next, hash_find_entry,
	hash_rehash): Replace `if (limit <= value) abort ();' with
	`if (! (value < limit)) abort ();', for readability.

2002-11-26    <karl@gnu.org>

	* strdup.c: copy from libc again, with jim's ok.
	* .cppi-disable: re-add strdup.c

2002-11-25    <karl@gnu.org>

	* strtoll.c: copy from libc, meaning we now #include <strtol.c>
	instead of "strtol.c".

2002-11-25  Jim Meyering  <jim@meyering.net>

	* mktime.c: Sync from libc, now that it has the latest fix.

2002-11-24    <karl@gnu.org>

	* error.c, getopt.c, getopt.h, getopt1.c, obstack.c, regex.c,
	regex.h, strdup.c, strtoll.c, tempname.c: change license to gpl.

2002-11-24  Jim Meyering  <jim@meyering.net>

	Update from coreutils:

	* mktime.c: Merge in changes from libc.

	Avoid a link-time failure on some Linux systems.
	* mktime.c (STATIC): Define to be empty (_LIBC) or `static' (otherwise).
	(__mon_yday): Declare with the STATIC attribute.
	(__mktime_internal): Likewise.
	Based on a report from Greg Schafer.

2002-11-23  Jim Meyering  <jim@meyering.net>

	* sig2str.c (str2signum, sig2str): Avoid a warning from gcc:
	Use `unsigned', not `int', as type of index.

	* xstat.in [@BEGIN_LSTAT_ONLY@]: Include <string.h>.

	* fsusage.c: Remove unneeded parentheses around operands of `defined'.

2002-11-22  Paul Eggert  <eggert@twinsun.com>

	* hash.c: Avoid use of <assert.h>, as the GNU Coding Standards
	hint that one should use `if (! x) abort ();' rather than `assert
	(x);', and anyway it's one less thing to worry about configuring.
	(hash_lookup, hash_get_first, hash_get_next, hash_find_entry,
	hash_rehash, hash_insert): Use abort rather than assert.

2002-11-22  Paul Eggert  <eggert@twinsun.com>

	* quotearg.h: Allow multiple inclusion by surrounding with
	"#ifndef QUOTEARG_H_".  Include <stddef.h>, for size_t,
	so that we can be included first.
	(PARAMS): Remove; we now assume C89 or later.  All uses removed.
	* quotearg.c: Include quotearg.h immediately after config.h.
	No need to include stddef.h or sys/types.h any more.
	Surround local include files with "", not "<>".
	Assume HAVE_LIMITS_H unconditionally, as we assume C89.
	Similarly, assume HAVE_C_BACKSLASH_A, CHAR_BIT, UCHAR_MAX, UINT_MAX,
	HAVE_STDLIB_H, HAVE_STRING_H, STDC_HEADERS.
	(HAVE_MBSINIT): Undef if !HAVE_MBRTOWC.
	(mbsinit): Define to 1 if !defined mbsinit && !HAVE_MBSINIT.
	(ISPRINT): Remove; no longer needed now that we assume C89.

	(clone_quoting_options, quotearg_buffer, quotearg_n_options):
	Preserve errno.

	(quotearg_buffer_restyled, quotearg_n, quotearg_n_style,
	quotearg_char): Use SIZE_MAX rather than
	(size_t) -1 when we are talking about "infinity".

	(quotearg_buffer_restyled): Fix bug when quoting trigraphs.

2002-11-22  Bruno Haible  <bruno@clisp.org>

	* safe-read.h: Assume C89. Add comments.
	(safe_read): Change return type to size_t.
	* safe-read.c (safe_read): Change return type to size_t. Handle byte
	counts > SSIZE_MAX correctly.
	* safe-write.h: New file.
	* safe-write.c: New file.
	* full-read.h: New file.
	* full-read.c: New file.
	* full-write.h: Assume C89. Add comments.
	* full-write.c: Include safe-write.h.
	(full_write): Rewritten to use safe_write.
	Suggested by Jim Meyering and Paul Eggert.

2002-11-21  Bruno Haible  <bruno@clisp.org>

	Remove case insensitive option matching.
	* argmatch.h (argcasematch): Remove declaration.
	(ARGCASEMATCH): Remove macro.
	(__xargmatch_internal): Remove case_sensitive argument.
	(XARGMATCH): Update.
	(XARGCASEMATCH): Remove macro.
	* argmatch.c (argmatch): Renamed from __argmatch_internal. Remove
	case_sensitive argument.
	(argcasematch): Remove function.
	(__xargmatch_internal): Remove case_sensitive argument.
	(main): Use XARGMATCH instead of XARGCASEMATCH.

	* xmalloc.c: Change compile-time error message. Add comment about
	required autoconf version.

2002-11-21  Jim Meyering  <jim@meyering.net>

	* strdup.c (strdup): Tweak comment and initial #if/#include.

	Merge in changes from the coreutils.

	2002-09-25  Paul Eggert  <eggert@twinsun.com>
	* fsusage.c [! HAVE_INTTYPES_H && HAVE_STDINT_H] Include <stdint.h>.
	(UINTMAX_MAX) [!defined UINTMAX_MAX]: New macro.
	(PROPAGATE_ALL_ONES): Work even if X is unsigned and narrower than
	int.  Work more efficiently if X is the same width as uintmax_t.
	Do not compare X to -1, to avoid bogus compiler warning.
	(get_fs_usage): (uintmax_t) -1 -> UINTMAX_MAX to avoid a cast.
	Don't assume that f_frsize and f_bsize are the same type.

	* mountlist.c: #undef MNT_IGNORE before defining it, to avoid warning
	on FreeBSD.

	* makepath.c (make_path): Restore umask *before* creating the final
	component.
	(make_path): Minor reformatting.

	* xmalloc.c: Adjust to work with new autoconf macros, AC_FUNC_MALLOC
	and AC_FUNC_REALLOC: test #ifndef HAVE_MALLOC/HAVE_REALLOC.

	* mountlist.h (ME_DUMMY): Don't count entries of type `auto' as dummy
	ones.  At least on GNU/Linux systems, `auto' means something else.
	From Michael Stone.

2002-11-20  Paul Eggert  <eggert@twinsun.com>

	Merge argmatch cleanups from Bison.  Assume C89.

	* argmatch.c: Include config.h here, not in argmatch.h.
	Include stdlib.h, for EXIT_FAILURE.
	Always include <string.h>, since we assume C89.
	(EXIT_FAILURE): Remove pre-C89 bug workaround.
	* argmatch.h: Do not include <config.h> or <sys/types.h>.
	Include <stddef.h> instead, since it's all we need for size_t.
	(PARAMS): Remove.  All uses removed.
	(ARRAY_CARDINALITY): Do not bother to #undef.
	(ARRAY_CARDINALITY, ARGMATCH, ARGCASEMATCH, invalid_arg,
	ARGMATCH_VALID, XARGMATCH, XARGCASEMATCH):
	Remove unnecessary parentheses.
	(ARGMATCH_VALID, XARGMATCH, XARGCASEMATCH):
	Insert necessary parentheses.
	(ARGMATCH_CONSTRAINT, ARGMATCH_VERIFY): New macros.
	(ARGMATCH_ASSERT): Use ARGMATCH_CONSTRAINT.

2002-11-19  Bruno Haible  <bruno@clisp.org>

	* mbswidth.c: Include mbswidth.h right at the beginning.
	* mbswidth.h: Include <stddef.h>, for size_t.

	* mbswidth.h (PARAMS): Remove macro.
	(mbswidth, mbsnwidth): Use ANSI C function declarations.
	* mbswidth.c (mbswidth, mbsnwidth): Likewise.

	* gcd.h (PARAMS): Remove macro.
	(gcd): Use ANSI C function declarations.
	* gcd.c (gcd): Likewise.

2002-11-15  Bruno Haible  <bruno@clisp.org>

	* strcspn.c: Include <stddef.h>.
	(strcspn): Use ANSI C function declaration. Change return type to
	size_t. Use NULL.
	* strpbrk.c: Minimize diffs to glibc. Include <stddef.h>.
	(strpbrk): Use NULL.
	* strpbrk.h (PARAMS): Remove macro.
	(strpbrk): Use ANSI C function declaration.
	* strstr.c: Don't include <sys/types.h>.
	* strstr.h (PARAMS): Remove macro.
	(strstr): Use ANSI C function declarations.

2002-11-06  Bruno Haible  <bruno@clisp.org>

	* gcd.h (gcd): Change argument type to 'unsigned long'.
	* gcd.c (gcd): Likewise.

2002-11-05  Bruno Haible  <bruno@clisp.org>

	* gcd.h: New file, from gettext-0.11.5.
	* gcd.c: New file, from gettext-0.11.5.

2002-11-05  Bruno Haible  <bruno@clisp.org>

	* error.c [!_LIBC]: Include gettext.h instead of <libintl.h>.
	* getopt.c [!_LIBC]: Include gettext.h instead of <libintl.h>.
	* obstack.c [!_LIBC]: Include gettext.h instead of <libintl.h>.
	* regex.c [!_LIBC]: Include gettext.h instead of <libintl.h>.

	* argmatch.c: Include gettext.h instead of <locale.h> and <libintl.h>.
	* makepath.c: Include gettext.h instead of <locale.h> and <libintl.h>.

	* closeout.c: Include gettext.h instead of <libintl.h>.
	* human.c: Include gettext.h instead of <libintl.h>.
	* quotearg.c: Include gettext.h instead of <libintl.h>.
	* rpmatch.c: Include gettext.h instead of <libintl.h>.
	* unicodeio.c: Include gettext.h instead of <libintl.h>.
	* userspec.c: Include gettext.h instead of <libintl.h>.
	* version-etc.c: Include gettext.h instead of <libintl.h>.
	* xmalloc.c: Include gettext.h instead of <libintl.h>.
	(textdomain): Remove definition.
	* xmemcoll.c: Include gettext.h instead of <libintl.h>.

	* long-options.c: Remove include of <libintl.h> and definition of _.
	* same.c: Remove include of <libintl.h> and definition of _.

2002-11-04  Bruno Haible  <bruno@clisp.org>

	* stpcpy.h: New file, from GNU gettext-0.11.5.
	* strcase.h: New file, from GNU gettext-0.11.5.
	* strpbrk.h: New file, from GNU gettext-0.11.5.
	* strstr.h: New file, from GNU gettext-0.11.5.
	* xgetcwd.h: New file, from GNU gettext-0.11.5.

2002-05-09  Bruno Haible  <bruno@clisp.org>

	* config.charset: Update for newest glibc. Add canonical names
	ISO-8859-14, KOI8-T, TCVN5712-1, GEORGIAN-PS.

2002-05-09  Bruno Haible  <bruno@clisp.org>

	* localcharset.c (get_charset_aliases): Add more Windows specific
	aliases.

2002-05-08  Owen Taylor  <otaylor@redhat.com>

	* config.charset: A few additions for Solaris.

2001-12-05  Bruno Haible  <bruno@clisp.org>

	* localcharset.c (locale_charset): Don't return an empty string.

2001-10-23  Bruno Haible  <haible@clisp.cons.org>

	* config.charset: msdos in uk_UA uses CP1125.

2001-08-05  Bruno Haible  <haible@clisp.cons.org>

	Make it possible to build libcharset with CC=gcc CFLAGS="-x c++".
	* localcharset.c (locale_charset): Declare as extern "C".

2002-02-15  Bruno Haible  <bruno@clisp.org>

	* config.charset [msdosdjgpp]: For Russian, use CP866.

2002-02-11  Bruno Haible  <bruno@clisp.org>

	* config.charset: Add support for NetBSD.

2002-09-25    <karl@gnu.org>

	* strdup.c: copy from libc/string (via ../config/srclist*).
	* getopt*: copy from libc/posix.
	* gettext.h: copy from gettext.
	* .cppi-disable: add strdup.c, gettext.h.

2002-07-01  Jim Meyering  <meyering@lucent.com>

	* c-stack.c: Include sys/time.h.
	From Volker Borchert.

2002-06-11  Paul Eggert  <eggert@twinsun.com>

	* fnmatch.c, fnmatch_loop.c (WIDE_CHAR_SUPPORT):
	New macro.  Use it uniformly instead of
	(defined HAVE_WCTYPE_H && defined HAVE_WCHAR_H).
	It also uses HAVE_BTOWC, to fix a porting bug on Solaris 2.5.1
	reported by Vin Shelton.

2002-06-22  Jim Meyering  <meyering@lucent.com>

	* fnmatch.c (ISASCII, ISPRINT): Undefine, to avoid warning about
	redefinition due to Solaris 2.6's definition in /usr/include/sys/euc.h.

2002-06-22  Paul Eggert  <eggert@twinsun.com>

	* c-stack.h (segv_handler, c_stack_action) [! defined SA_SIGINFO]:
	Do not assume SA_SIGINFO behavior.
	Bug reported by Jim Meyering on NetBSD 1.5.2.

2002-06-22  Jim Meyering  <meyering@lucent.com>

	* c-stack.c, c-stack.h: New files, from diffutils-2.8.2.

	* exitfail.c, exitfail.h: Likewise.
	* Makefile.am (libfetish_a_SOURCES): Add exitfail.c and exitfail.h.

	* Makefile.am (libfetish_a_SOURCES): Add fnmatch_.h in place
	of fnmatch.h.
	(EXTRA_DIST): Add fnmatch_loop.c.
	(libfetish_a_SOURCES): Add c-stack.c and c-stack.h.

	* fnmatch_loop.c: New file, from diffutils-2.8.2.
	* fnmatch.c: Update from diffutils-2.8.2.
	* fnmatch_.h: New file.  From diffutils-2.8.2.
	* fnmatch.h: Remove file.

2002-06-18  Paul Eggert  <eggert@twinsun.com>

	* file-type.h: Report an error if neither S_ISREG nor
	S_IFREG is defined, instead of using a test specific to glibc
	2.2.  This should be safe, since POSIX requires S_ISREG and
	Unix Version 7 had S_IFREG.  We don't need to check for
	<sys/types.h> since we don't use any symbols that it defines.

2002-06-15  Jim Meyering  <meyering@lucent.com>

	* file-type.h (FILE_TYPE_H): Guard entire contents with #ifndef.
	For GNU libc 2.2 and newer, ensure that <sys/types.h> and <sys/stat.h>
	have been included before this file.

2002-06-13  Richard Dawe  <richdawe@bigfoot.com>

	* Makefile.am (lstat.c, stat.c, .sin.sed): Use t-$@, rather than $@-t,
	so that each temporary file name is unique and valid in the first
	8 characters, for operation under DOS.

2002-06-15  Jim Meyering  <meyering@lucent.com>

	Work even with DJGPP 2.03, which lacks support for symlinks.
	From Richard Dawe.
	* xstat.in (S_ISLNK): Define to 0 if neither S_ISLNK nor S_IFLNK
	is defined.
	* lchown.c (S_ISLNK): Likewise.

2002-06-14  Jim Meyering  <meyering@lucent.com>

	* file-type.h: Use the version from diffutils-2.8.2.
	* file-type.c: Likewise.

2002-05-27  Jim Meyering  <meyering@lucent.com>

	Fix a problem seen only on nonconforming systems whereby ls.c's
	use of localtime, and then of gettimeofday would cause trouble:
	the localtime call used to initialize rpl_gettimeofday's save
	mechanism would clobber ls's current local time information so
	that in any long listing the first file would always be listed
	with date 1970-01-01.  Analysis by Volker Borchert.

	* gettimeofday.c (localtime): Undefine.
	(rpl_localtime): New function.

2002-05-22  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (libfetish_a_SOURCES): Add file-type.c and file-type.h.
	* file-type.h: New file.
	* file-type.c (file_type): New file/function.  Extracted from diffutils.

2002-04-29  Paul Eggert  <eggert@twinsun.com>

	* hard-locale.c: Upgrade to version used in GNU Diffutils 2.8.1.

2002-04-28  Paul Eggert  <eggert@twinsun.com>

	* sig2str.h (SIGNUM_BOUND): Do not use WTERMSIG, to avoid
	depending on <sys/wait.h> and WTERMSIG.  Default to 64 instead
	of 127, since 64 is the largest conceivable number for ancient
	nonstandard hosts.
	* sig2str.c: Do not include <sys/wait.h>; no longer needed.

2002-04-28  Jim Meyering  <meyering@lucent.com>

	* sig2str.c (WTERMSIG): Remove definition (unused).

2002-04-28  Paul Eggert  <eggert@twinsun.com>

	* sig2str.h, sig2str.c: New files.
	* Makefile.am (libfetish_a_SOURCES): Add sig2str.h.

2002-04-24  Jim Meyering  <meyering@lucent.com>

	* gettext.h: New file, from Gettext.
	* Makefile.am (INCLUDES): Remove -I../intl.
	(libfetish_a_SOURCES): Add gettext.h.

2002-04-16  Jim Meyering  <meyering@lucent.com>

	* readutmp.h (UT_TYPE): Remove definition (now in who.c).
	(HAVE_STRUCT_XTMP_UT_EXIT, HAVE_STRUCT_XTMP_UT_ID): Define.
	(HAVE_STRUCT_XTMP_UT_PID, HAVE_STRUCT_XTMP_UT_TYPE): Define.

2002-04-12  Jim Meyering  <meyering@lucent.com>

	* dirfd.h (dirfd): Elide prototype if dirfd is a macro.

2002-03-10  Jim Meyering  <meyering@lucent.com>

	* makepath.c (make_path): Remove a comma from a diagnostic.
	Suggestion from Santiago Vila.

2002-03-08  Jim Meyering  <meyering@lucent.com>

	* rename.c: Mention that this wrapper is needed also on
	mips-dec-ultrix4.4 systems.

2002-03-02  Jim Meyering  <meyering@lucent.com>

	* gettime.c (gettime): Test HAVE_CLOCK_GETTIME,
	not HAVE_CLOCK_SETTIME.

2002-02-27  Paul Eggert  <eggert@twinsun.com>

	* nanosleep.h: Rename to....
	* timespec.h: New name for nanosleep.h.  All uses changed.

	* gettime.c: New file.
	* settime.c: New file.
	* stime.c: Remove.

	* Makefile.am (libfetish_a_SOURCES): Add gettime.c, settime.c,
	timespec.h.  Remove nanosleep.h.

2002-02-25  Paul Eggert  <eggert@twinsun.com>

	* acl.c, acl.h: New files.
	* Makefile.am (libfetish_a_SOURCES): Add acl.h, acl.c.

2002-02-24  Jim Meyering  <meyering@lucent.com>

	* strnlen.c (strnlen): Define-away/undef so that an inconsistent
	prototype in string.h (on at least AIX4.3.2.0 w/gcc-2.95.3) doesn't
	cause trouble.  Reported by Nelson Beebe.

2002-02-23  Paul Eggert  <eggert@twinsun.com>

	* path-concat.c (xpath_concat): Reorder code to pacify
	compilers that don't know that xalloc_die never returns.

2002-02-20  Jim Meyering  <meyering@lucent.com>

	* getdate.c: Regenerate using bison-1.33.

2002-02-15  Paul Eggert  <eggert@twinsun.com>

	* posixver.c, posixver.h: New files.
	* Makefile.am (libfetish_a_SOURCES): Add them.

2002-02-02  Paul Eggert  <eggert@twinsun.com>
	    Bruno Haible  <bruno@clisp.org>

	* unicodeio.h (print_unicode_char): Add exit_on_error argument.
	(fwrite_success_callback): New declaration.
	* unicodeio.c (unicode_to_mb): New function, extracted from
	print_unicode_char. Call failure callback instead of error.
	(fwrite_success_callback): New function.
	(exit_failure_callback): New function.
	(fallback_failure_callback): New function.
	(print_unicode_char): Call unicode_to_mb.

2002-01-26  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (getdate$U.o): Depend on unlocked-io.h.

2002-01-22  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (Makefile): Don't depend on $(BUILT_SOURCES).
	Otherwise, some versions of automake would omit the rule that makes
	Makefile from Makefile.in.

2001-01-21  Paul Eggert  <eggert@twinsun.com>

	* xmemcoll.h, xmemcoll.c: New files.
	* Makefile.am (libfetish_a_SOURCES): Add them.
	* memcoll.c: Include errno.h, and declare errno if not defined.
	(memcoll): Set errno to zero if there is no error.

	* quotearg.c (quotearg_buffer_restyled):
	Fix bug with quoting buffers containing NUL when backslashing escapes.
	This bug was exposed by the other changes in this patch.
	(quotearg_n_options): New arg ARGSIZE.
	All callers changed.
	(quoting_options_from_style): New function.
	(quotearg_n_style): Use it.
	(quotearg_n_style_mem): New function.

	* quotearg.h (quotearg_n_style_mem): New function.

2002-01-16  Jim Meyering  <meyering@lucent.com>

	* getdate.y: Add three semicolons, each just before a closing brace.
	Bison (as of version 1.31) no longer papers over that mistake.

2002-02-14  Paul Eggert  <eggert@twinsun.com>

	* backupfile.c (ISDIGIT): Comment fix.
	* getdate.y (ISDIGIT): Likewise.
	* posixtm.c (ISDIGIT, year): Likewise.
	* strverscmp.c (ISDIGIT): Likewise.
	* userspec.c (ISDIGIT): Likewise.

2002-01-05  Jim Meyering  <meyering@lucent.com>

	* version-etc.c (version_etc_copyright): Update copyright year.

2001-01-19  Paul Eggert  <eggert@twinsun.com>

	* closeout.c (close_stdout_status): If ferror (stdout), do
	not silently exit merely because the output buffer happens to
	have nothing pending.

2001-12-18  Paul Eggert  <eggert@twinsun.com>

	See the big note in ../ChangeLog.
	* human.c (suffixes): Prefer K to k for 1024.
	(generate_suffix_backwards): New function.
	(human_readable_inexact): Use it.
	* xstrtol.c (__xstrtol): If there is no number but there
	is a valid suffix, assume 1.  "MB" now means decimal, "MiB" binary.
	Accept 'K' as well as 'k'.

2001-12-15  Jim Meyering  <meyering@lucent.com>

	* regex.h (__restrict_arr): Update from libc.

	* mountlist.h (ME_REMOTE): Recognize file systems of type smbfs
	as `remote' if the name starts with `//'.  Suggested by Michael Stone.
	(STREQ): Define.

2001-12-10  Jim Meyering  <meyering@lucent.com>

	* linebuffer.c: Remove explicit declarations of xmalloc and xrealloc,
	Instead, include "xalloc.h".
	(initbuffer): Don't cast xmalloc return value to char*.
	(readline): Reword comment.
	Don't cast xrealloc return value to char*
	Return NULL, not 0.

2001-12-09  Jim Meyering  <meyering@lucent.com>

	* modechange.c (mode_compile): Add cast to avoid pedantic warning about
	`signed and unsigned type in conditional expression'.
	* posixtm.c (posix_time_parse): Likewise.

	* xreadlink.c (xreadlink): Add cast to avoid a pedantic warning.

	* readtokens.c (readtoken): Declare an index to be of type unsigned
	to avoid a pedantic warning.

	* getstr.c: Don't include assert.h.
	(getstr): Remove warning-evoking assertions.
	Return -1 if offset parameter is out of bounds.
	Change the type of a local from int to size_t.

	* strftime.c (my_strftime_localtime_r): Include this function
	definition in the `#if ! HAVE_TM_GMTOFF' block.

	* xgethostname.c: Remove declarations of xmalloc and xrealloc.
	Include xalloc.h instead.

2001-12-02  Jim Meyering  <meyering@lucent.com>

	* tempname.c: Don't declare getenv, thus reverting the change of
	2001-11-18.  It's no longer necessary, now that stdlib.h is always
	included.

	* regex.c [!__BOUNDED_POINTERS__]: Define away __bounded,
	__unbounded, and __ptrvalue.  Reported by Uwe H. Steinfeld.

2001-11-30  Akim Demaille  <akim@epita.fr>

	* xstrdup.c: Include xalloc.h, so that xstrdup is declared
	before being defined.

2001-11-27  Paul Eggert  <eggert@twinsun.com>

	* quotearg.h (quotearg_n, quotearg_n_style):
	First arg is int, not unsigned.
	* quotearg.c (quotearg_n, quotearg_n_style): Likewise.
	(SIZE_MAX, UINT_MAX): New macros.
	(quotearg_n_options): Abort if N is negative.
	Avoid overflow check on hosts where size_t is 64 bits and int
	is 32 bits, as overflow is impossible there.
	Fix off-by-one typo that caused unnecessary reallocation.

2001-11-27  Jim Meyering  <meyering@lucent.com>

	* tempname.c: Merge with version from libc.
	* regex.c: Likewise.

	* tempname.c: Include stdlib.h unconditionally.  On some old systems
	for which STDC_HEADERS is 0, it was not included, resulting in a
	warning about an integer-to-pointer conversion problem with getenv.
	Reported by Volker Borchert.

2001-11-26  Jim Meyering  <meyering@lucent.com>

	* gtod.h: Remove file.
	* Makefile.am (libfetish_a_SOURCES): Remove gtod.h.
	* gettimeofday.c: Don't include gtod.h.
	(GTOD_init): Remove function.
	(rpl_gettimeofday): Do its job here instead, rather than aborting.
	Suggestion from Volker Borchert.

2001-11-23  Jim Meyering  <meyering@lucent.com>

	* hash.h (struct hash_table): Don't define here.  Merely declare it.
	* hash.c (struct hash_table): Define it here instead.

2001-11-22  Jim Meyering  <meyering@lucent.com>

	* hash.h: Bracket contents of file with #ifndef HASH_H_ ... #endif.

2001-11-18  Paul Eggert  <eggert@twinsun.com>

	* tempname.c (TMP_MAX): Remove; no longer needed.
	(TEMPORARIES): New macro.
	(__gen_tempname): Use TEMPORARIES rather than TMP_MAX.  This
	removes an artificial limitation (e.g. HP-UX 10.20, where
	TMP_MAX is 17576).

2001-11-18  Jim Meyering  <meyering@lucent.com>

	* tempname.c [!HAVE_DECL_GETENV]: Declare getenv to avoid warning
	on SunOS 4.

	* Makefile.am (Makefile): Depend on $(BUILT_SOURCES), so those
	files will be created before anything else.

2001-11-17  Jim Meyering  <meyering@lucent.com>

	* modechange.c (mode_adjust): Fix error introduced on 1999-04-26
	that made e.g., `chmod a=,o=w,g=o F' cause F to be group readable
	rather than group writable.  Patch by Juan F. Codagnone.

	* readtokens.c: Remove explicit declarations of xmalloc and xrealloc,
	Instead, include "xalloc.h".

	* mountlist.c: Include unlocked-io.h after all system headers.
	Remove explicit declarations of xmalloc, xrealloc,
	and xstrdup.  Instead, include "xalloc.h".

	* argmatch.c, closeout.c, error.c, exclude.c: Include unlocked-io.h.
	* fatal.c, getdate.y, getpass.c, getstr.c, getusershell.c: Likewise.
	* mountlist.c, posixtm.c, readtokens.c, readutmp.c: Likewise.

	* regex.c, sha.c, version-etc.c, yesno.c: Likewise.
	Reported by Padraig Brady.

	* mkstemp.c: #undef mkstemp.
	Include config.h.
	(rpl_mkstemp): Rename from mkstemp.
	Protoize.

2001-11-16  Jim Meyering  <meyering@lucent.com>

	* physmem.c [HAVE_SYS_PSTAT_H]: Include <sys/pstat.h>.
	(physmem_total) [HAVE_PSTAT_GETSTATIC]: If sysconf couldn't be used to
	determine the amount of total physical memory, use pstat_getstatic.
	HPUX-11 doesn't define _SC_PHYS_PAGES.
	(physmem_available) [HAVE_PSTAT_GETSTATIC && HAVE_PSTAT_GETDYNAMIC]:
	If sysconf couldn't be used to determine the amount of available
	physical memory, use both pstat_getstatic and pstat_getdynamic.
	Based on a patch from Bob Proulx.

2001-11-05  Jim Meyering  <meyering@lucent.com>

	* xstat.in (slash_aware_lstat): Correct a misleading comment.

2001-11-03  Jim Meyering  <meyering@lucent.com>

	* argmatch.h (ARGMATCH_TO_ARGUMENT): Remove casts of first two args
	in argmatch_to_argument call.

	* dirfd.c (dirfd): Reflect the fact that DIR_TO_FD now takes an
	argument.

	* hash.c (hash_clear): Fix a bug that could lead to an infloop or
	e.g., a fault due to an attempt to free a NULL pointer.

2001-11-01  Jim Meyering  <meyering@lucent.com>

	* dirfd.c, dirfd.h: New files.
	* Makefile.am (libfetish_a_SOURCES): Add dirfd.h.

	* hash.c (hash_print) [TESTING]: Clean up.

2001-10-22  Paul Eggert  <eggert@twinsun.com>

	* hard-locale.c (alloca): Define to __builtin_alloca if __GNUC__,
	to avoid a warning if -Wall.

2001-10-21  Paul Eggert  <eggert@twinsun.com>

	* regex.c (uintptr_t): Remove macro and decl; it's config.h's job.

2001-10-21  Jim Meyering  <meyering@lucent.com>

	* obstack.c (_): Honor the setting of ENABLE_NLS.  Otherwise,
	this code would end up calling gettext even in packages built
	with --disable-nls.
	* getopt.c (_): Likewise.
	* regex.c (_): Likewise.

2001-10-20  Paul Eggert  <eggert@twinsun.com>

	* error.c (strerror_r): Do not declare unless !_LIBC.
	Do not check for HAVE_DECL_STRERROR_R missing unless STRERROR_R_CHAR_P.
	Use strerror_r that is only a macro, even if it is not a function.
	(strerror): Check for HAVE_DECL_STRERROR before declaring.
	(private_strerror): Use prototypes, not old-style function definition.
	(print_errno_message): New function.
	Support the POSIX 'int'-flavored strerror_r, as well as the traditional
	char*-flavored one.
	(error_tail, error, error_at_line): Use it.

2001-10-11  Jim Meyering  <meyering@lucent.com>

	* argmatch.c (argmatch_invalid): Use quotearg_n_style (0, ...
	and quote_n (1, ... to avoid clobbering a buffer.

2001-10-05  Jim Meyering  <meyering@lucent.com>

	* Makefile.am: (libfetish_a_SOURCES): Add hash-pjw.c and hash-pjw.h.
	* hash-pjw.c: New file (factored out of fileutils' remove.c).
	* hash-pjw.h: New file.

2001-09-30  Jim Meyering  <meyering@lucent.com>

	* mountlist.c [MOUNTED_GETFSSTAT]:
	Include <sys/ucred.h>, for Apple Darwin.
	Include sys/mount.h and sys/fs_types.h only if available.
	(FS_TYPE): Define.
	(read_filesystem_list): Use FS_TYPE.

2001-09-29  Paul Eggert  <eggert@twinsun.com>

	* exclude.c (excluded_filename): 0 -> false, since it's
	a boolean context.

2001-09-28  Paul Eggert  <eggert@twinsun.com>

	Fix bug reported by Petter Reinholdtsen for HP-UX 10.20, which
	#defines strtoimax.  Also treat the other strto* functions
	like strtoimax.

	* xstrtol.c (strtol): Do not declare if HAVE_DECL_STRTOL.
	(strtoul): Do not declare if HAVE_DECL_STRTOUL.
	(strtoimax, strtoumax): Do not declare if already defined as a macro.

2001-09-26  Jim Meyering  <meyering@lucent.com>

	Most macros in unlocked-io.h had the wrong number of arguments.
	* gen-uio: New script.
	(USE_UNLOCKED_IO): Define to 1 if not already defined.
	* unlocked-io.hin: Remove file.
	* Makefile.am (unlocked-io.h): Rewrite to use a separate script,
	rather than trying to embed it here.
	(EXTRA_DIST): Add gen-uio.  Remove unlocked-io.hin
	Reported by Padraig Brady.

2001-09-25  Volker Borchert  <bt@teknon.de>

	* gettimeofday.c (rpl_gettimeofday): Declare local variable `result'.

2001-09-23  Jim Meyering  <meyering@lucent.com>

	* mountlist.c: Remove useless parentheses in #if directives.
	(MOUNTED) [!defined MOUNTED]: Define to _PATH_MOUNTED, for when
	the deprecated MOUNTED symbol is no longer defined in mntent.h.

2001-09-22  Jim Meyering  <meyering@lucent.com>

	* localcharset.c: Update from latest gettext.
	* config.charset: Likewise.

2001-09-20  Jim Meyering  <meyering@lucent.com>

	* xstrtol.c (strtoimax): Guard declaration with
	`#if !HAVE_DECL_STRTOIMAX', rather than just `#ifndef strtoimax'.
	The latter fails because some systems (at least rs6000-ibm-aix4.3.3.0)
	have their own, conflicting declaration of strtoimax in sys/inttypes.h.
	(strtoumax): Likewise, for completeness (it wasn't necessary).

2001-09-06  Paul Eggert  <eggert@twinsun.com>

	* strtoimax.c (HAVE_LONG_LONG):
	Redefine to HAVE_UNSIGNED_LONG_LONG if unsigned.
	(strtoimax): Use sizeof (long), not sizeof strtol (ptr, endptr, base),
	to work around bug in IBM C compiler.

2001-09-16  Jim Meyering  <meyering@lucent.com>

	* mkdir.c: New file.

2001-09-04  Paul Eggert  <eggert@twinsun.com>

	* xgetcwd.c: Revert some of the previous change; intead,
	fix the HAVE_GETCWD_NULL code to behave more like the
	!HAVE_GETCWD_NULL code used to.

	Include "xalloc.h".
	(xgetcwd): Do not return NULL when memory is exhausted; instead,
	invoke xalloc_die.

2001-09-04  Paul Eggert  <eggert@twinsun.com>

	* xreadlink.c (xreadlink): Omit size_t* arg.  All uses changed.
	Use ssize_t, not int, to store result of readlink.
	Check for ssize_t overflow as well as size_t overflow,
	as POSIX says the result of readlink is implementation-defined
	when ssize_t overflows.
	Remove unnecessary cast to char*.
	Use free+malloc instead of realloc, as the storage doesn't need
	to be preserved and it's clearer and can be more efficient that way.
	(SIZE_MAX, SSIZE_MAX): New macros, if <limits.h> doesn't declare.
	* xreadlink.h (xreadlink): Update prototype.

2001-09-03  Paul Eggert  <eggert@twinsun.com>

	* exclude.c (fnmatch_no_wildcards): Fix confusion between
	usage of FNM_CASEFOLD and FNM_LEADING_DIR.  The bug was
	spotted by Jim Meyering.

2001-09-03  Jim Meyering  <meyering@lucent.com>

	* xreadlink.c (xreadlink): Preserve errno around `free' during failure.

2001-09-03  Paul Eggert  <eggert@twinsun.com>

	* xgetcwd.c: Fix the !HAVE_GETCWD_NULL code to behave more
	like the HAVE_GETCWD_NULL code.
	Include pathmax.h if not HAVE_GETCWD.
	Do not include xalloc.h.
	(INITIAL_BUFFER_SIZE): New symbol.
	Do not use xmalloc / xrealloc, since the caller is responsible for
	handling errors.  Preserve errno around `free' during failure.
	Do not overrun buffer when using getwd.

2001-09-03  Paul Eggert  <eggert@twinsun.com>

	* xgetcwd.c (xgetcwd): Use HAVE_GETCWD_NULL, not (defined
	__GLIBC__ && __GLIBC__ >= 2), to decide whether to use getcwd (NULL, 0).

2001-09-02  Jim Meyering  <meyering@lucent.com>

	* error.c: Update from GNU libc.

2001-09-01  Jim Meyering  <meyering@lucent.com>

	* xreadlink.c: New file.
	* xreadlink.h: New file.
	* Makefile.am (libfetish_a_SOURCES): Add xreadlink.c and xreadlink.h.

	* regex.c (uintptr_t) [!_LIBC]: Define to private_uintptr_t, so it
	doesn't conflict with sparc Solaris 7's definition in
	/usr/include/sys/int_types.h.

	* exclude.c: Use `""', not `<>' to #include non-system header files.
	(fnmatch_no_wildcards): Rewrite not to use function names, strcasecmp
	and strncasecmp as r-values.  Unixware didn't have declarations.

2001-08-31  Jim Meyering  <meyering@lucent.com>

	* xgetcwd.c (xgetcwd): Reorganize to avoid some duplication.
	Use an initial, malloc'd, buffer of length 128 rather than
	a statically allocated one of length 1024.

2001-08-30  Paul Eggert  <eggert@twinsun.com>

	* xgetcwd.c: Don't include pathmax.h.
	Include stdlib.h and unistd.h if available.
	Include xalloc.h.
	(xmalloc, xstrdup, free): Remove decls.
	(xgetcwd): Don't assume sizes fit in unsigned.
	Check for overflow when computing sizes.
	Simplify reallocation code.

2001-08-28  Paul Eggert  <eggert@twinsun.com>

	* Makefile.am (libfetish_a_SOURCES): Remove strtoxmax.c.

	* strtoimax.c: Renamed from strtoxmax.c, removing the
	old strtoimax.c.

	Also, make the following further changes to make this file's
	configuration more similar to that of strtol.c:
	(UNSIGNED): Renamed from STRTOUXMAX_UNSIGNED.  All uses changed.
	(strtoumax, uintmax_t, strtoull, strtol): Remove.
	(intmax_t, strtoimax, strtol, strtoll): New macros, if UNSIGNED.
	(strtoimax): Renamed from strtoumax.  All uses of unsigned values
	changed to signed values.

	And make the following changes as well:
	Fix copyright notice, as 1999 was missing.
	(verify): New macro.
	(strtoimax): Check sizes at compile-time, not run-time.
	Prefer strtol to strtoll if both work.
	(main): Remove; it was not that useful and was a pain to maintain.

	* strtoumax.c: Include strtoimax.c, not strtouxmax.c.

2001-08-30  Paul Eggert  <eggert@twinsun.com>

	* savedir.c (savedir): Remove size parameter, as POSIX says that
	a directory's st_size can have an arbitrary value, so the old
	usage could waste an arbitrary amount of memory.  All uses
	changed.
	* savedir.h: Update prototype.

2001-08-30  Paul Eggert  <eggert@twinsun.com>

	* xstrtol.c (strtoimax): New decl.

2001-08-28  Paul Eggert  <eggert@twinsun.com>

	* xstrtol.h: Add copyright notice.
	(_DECLARE_XSTRTOL): Improve quality of diagnostic for
	LONGINT_INVALID_SUFFIX_CHAR.

2001-08-30  Paul Eggert  <eggert@twinsun.com>

	* quotearg.c: BSD/OS 4.1 wchar.h requires FILE and struct
	tm to be declared.

2001-08-30  Paul Eggert  <eggert@twinsun.com>

	* hash.c: Remove '2001' from copyright notice.

2001-08-30  Paul Eggert  <eggert@twinsun.com>

	* full-write.h: New file.
	* Makefile.am (libfetish_a_SOURCES): Add full-write.h.
	* full-write.c: Correct credits, as cccp.c no longer
	exists and anyway it was so heavily changed from the old cccp
	code as to be unrecognizable.  Include full-write.h.
	(full_write) Return size_t, with short writes meaning failure.
	All callers changed.  This fixes a bug with large buffers
	on 64-bit hosts.
	* utime.c: Include full-write.h.

2001-08-30  Paul Eggert  <eggert@twinsun.com>

	Merge 'exclude' changes from tar 1.13.22.
	This fixes one or two unlikely storage allocation overflow bugs,
	but doesn't change user-visible behavior otherwise.

2001-08-30  Paul Eggert  <eggert@twinsun.com>

	* exclude.c (bool): Declare, perhaps by including stdbool.h.
	(<sys/types.h>): Include only if HAVE_SYS_TYPES_H.
	(<stdlib.h>, <string.h>, <strings.h>, <inttypes.h>, <stdint.h>):
	Include	if available.
	(<xalloc.h>): Include
	(SIZE_MAX): Define if <stdint.h> or <inttypes.h> doesn't.
	(verify): New macro.  Use it to verify that EXCLUDE macros do not
	collide with FNM macros.
	(struct patopts): New struct.
	(struct exclude): Use it, as exclude patterns now come with options.
	(new_exclude): Support above changes.
	(new_exclude, add_exclude_file):
	Initial size must now be a power of two to simplify overflow checking.
	(free_exclude, fnmatch_no_wildcards): New function.
	(excluded_filename): No longer requires options arg, as the options
	are determined by add_exclude.  Now returns bool, not int.
	(excluded_filename, add_exclude):
	Add support for the fancy new exclusion options.
	(add_exclude, add_exclude_file): Now takes int options arg.
	Check for arithmetic overflow when computing sizes.
	(add_exclude_file): xrealloc might modify errno, so don't
	realloc until after errno might be used.

	* exclude.h (EXCLUDE_ANCHORED, EXCLUDE_INCLUDE,EXCLUDE_WILDCARDS):
	New macros.
	(free_exclude): New decl.
	(add_exclude, add_exclude_file): Now takes int options arg.
	(excluded_filename): No longer requires options arg, as the options
	are determined by add_exclude.  Now returns bool, not int.

2001-08-30  Paul Eggert  <eggert@twinsun.com>

	* alloca.c (alloca): Arg is of type size_t, not unsigned.

2001-08-27  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (libfetish_a_SOURCES): Add strtoxmax.c

	* version-etc.c (N_): Remove definition.
	Revert most of last change.
	Instead, simply don't mark the `Copyright...' string for translation.
	Based on advice from Paul Eggert.

	* strtoxmax.c: Tweak comment.

2001-08-26  Jim Meyering  <meyering@lucent.com>

	* version-etc.c (version_etc_copyright_fmt): Replace literal year
	of copyright with `%s' so translators don't get an untranslated
	message in 2002.
	(COPYRIGHT_YEAR): Define.
	(version_etc): Use fprintf rather than fputs.
	Suggestion from Ulrich Drepper.

	* Makefile.am (libfetish_a_SOURCES): Add xstrtoimax.c.

	* strtoll.c: New file, from GNU libc.
	* xstrtoimax.c: New file.

	* xstrtol.h: Add xstrtoimax.
	* strtoumax.c: New file.  Simply include "strtoumax.c".
	* strtoimax.c: New file.  Likewise, but first define STRTOUXMAX_SIGNED.

	* strtoumax.c: Factor to work both for unsigned and signed types, ...
	* strtoxmax.c: ... then renamed to this.

2001-08-13  Paul Eggert  <eggert@twinsun.com>

	* Makefile.am (unlocked-io.h): Do not append "_unlocked" twice.
	Port to Solaris 8, where 'sed' requires a space after the 'r'
	command, and where sh dislikes "$/".  Clean up the spacing a bit.
	Redirect output to $tmp just once.

2001-08-12  Paul Eggert  <eggert@sic.twinsun.com>

	* addext.c (<errno.h>): Include.
	(errno): Declare if not defined.
	(addext): Work correctly when pathconf returns -1 and leaves
	errno alone because there is no limit.  Also, work even if
	pathconf returns a value greater than SIZE_MAX.

2001-08-12  Jim Meyering  <meyering@lucent.com>

	* xgetcwd.c (xgetcwd) [defined __GLIBC__ && __GLIBC__ >= 2]:
	Simply `return getcwd (NULL, 0);'.
	[! (defined __GLIBC__ && __GLIBC__ >= 2)]:
	Use 1300 as initial value for length, not PATH_MAX.

	* pathmax.h: Clean up cpp syntax.

2001-08-12  Jim Meyering  <meyering@lucent.com>

	* gettimeofday.c: New file.
	* gtod.h: New file.
	* Makefile.am (libfetish_a_SOURCES): Add gtod.h.

2001-08-04  Jim Meyering  <meyering@lucent.com>

	* error.h (__attribute__): Remove `|| __STRICT_ANSI__' from #if stmt,
	to get in sync with glibc.

2001-08-03  Paul Eggert  <eggert@twinsun.com>

	The following changes are from gettext 0.10.39 as maintained by
	Bruno Haible.

	* mbswidth.h (MBSW_REJECT_UNPRINTABLE, MBSW_REJECT_INVALID):
	Renamed from MBSW_ACCEPT_UNPRINTABLE and MBSW_ACCEPT_INVALID
	with inverted sense.  All uses changed.

	* mbswidth.c: Don't include <limits.h>.
	Include <stdlib.h> and <string.h> unconditionally.
	(iswcntrl, mbsinit, ISCNTRL): New macros.
	(mbsnwidth): Use K&R style function declarations.
	Don't bother checking for MB_LEN_MAX == 1, since the compiler
	can optimize it when MB_CUR_MAX == 1.
	The width of control characters is zero, not 1.

2001-07-15  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (EXTRA_DIST): Add unlocked-io.hin.
	(BUILT_SOURCES): Add unlocked-io.h.
	(io_functions): Define.
	(unlocked-io.h): New rule.
	(DISTCLEANFILES): Add unlocked-io.h.
	(all-local): Depend on unlocked-io.h, to ensure it is created.

	* unlocked-io.hin: New file

	* regex.c: Update from glibc.

2001-07-05  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (noinst_HEADERS): Remove definition, per new automake
	recommendation.
	(libfetish_a_SOURCES): Put all .h files here instead.
	Remove a thus-exposed (better checks in automake) duplicate and
	two unnecessary .h files.

2001-06-11  Jim Meyering  <meyering@lucent.com>

	* regex.c: Update from GNU libc.

2001-05-27  Jim Meyering  <meyering@lucent.com>

	* readutmp.h (UT_TYPE): Define.

2001-05-24  Jim Meyering  <meyering@lucent.com>

	* argmatch.c: Include "quote.h".
	(argmatch_invalid): Remove explicit `' quotes.  Instead, use the
	quote function.  Reported by Gran Uddeborg.

2001-05-20  Alexandre Duret-Lutz  <duret_g@epita.fr>

	* dirname.c (dir_name): Compute append_dot using path, not newpath
	which is not yet declared.

2001-05-11  Paul Eggert  <eggert@twinsun.com>

	* Makefile.am (libfetish_a_SOURCES):
	Add strftime.c, since we now compile it on all hosts.

	* strftime.c (my_strftime):
	Define to nstrftime if emacs, but only if my_strftime is not defined.
	(extra_args, extra_args_spec, extra_args_spec_iso): Rename from
	ut_argument, ut_argument_spec, ut_argument_spec_iso, respectively.
	Add one more extra argument: a nanoseconds value.
	All uses changed.
	(ns): New macro.
	(my_strftime function): Add %N format.
	(emacs_strftimeu): Renamed from emacs_strftime,
	with extra ut argument.

2001-05-11  Paul Eggert  <eggert@twinsun.com>

	dirname code cleanup.  base_name now behaves more compatibly
	with POSIX basename when given file names that have trailing
	slashes, and similarly for dir_name.  Add new primitives
	base_len and dir_len.  Put the directory-name-related decls
	into dirname.h.

	* addext.c (ISSLASH, base_name): Remove; now in dirname.h.
	* backupfile.c (base_name): Likewise.
	* basename.c (FILESYSTEM_PREFIX_LEN, PARAMS, ISSLASH): Likewise.
	* dirname.c (FILESYSTEM_PREFIX_LEN, ISSLASH): Likewise.
	* makepath.c (strip_trailing_slashes): Likewise.
	* path-concat.c (DIRECTORY_SEPARATOR, FILESYSTEM_PREFIX_LEN, ISSLASH):
	Likewise.
	* rename.c (strip_trailing_slashes): Likewise.
	* same.c (base_name): Likewise.
	* stripslash.c (ISSLASH): Likewise.

	* addext.c: Include <dirname.h> after size_t is defined.
	* backupfile.c: Likewise.

	* addext.c (addext): Use base_len to trim redundant
	trailing slashes instead of doing it ourselves.
	But do not trim the last slash if it is not redundant.

	* backupfile.c (find_backup_file_name,
	max_backup_version): Use base_len instead of rolling it ourselves.
	Handle the case of "" and (on DOS) "C:" correctly.

	* basename.c: Do not include <stdio.h>, <assert.h>; no longer needed.
	Include <string.h>, <dirname.h>.
	(base_name): Allow file names ending in slashes, other than names
	that are all slashes.  In this case, return the basename followed
	by the slashes.  This is more general, and can be used in places
	where the original base_name purposely had an assertion failure.
	(base_len): New function.

	* dirname.c: Include <string.h> instead of <stdlib.h>.
	Do not include <assert.h>; no longer needed.
	Include xalloc.h.
	(memrchr): Remove decl.
	(dir_name_r): Remove.
	(dir_len): Renamed from dirlen.  All callers changed.
	Rewrite in terms of base_name, for simplicity and consistency.
	(dir_name): Never return NULL.  All callers changed.
	Do not include <stdlib.h> in test program; no longer needed.
	return 0; is fine for test program.

	* dirname.h (DIRECTORY_SEPARATOR, ISSLASH, FILESYSTEM_PREFIX_LEN):
	New macros.
	(base_name, base_len, dir_len, strip_trailing_slashes): New decls.

	* path-concat.c (path_concat): Use base_len to compute
	base length, not strlen; this means we cannot rely on memcpy
	to null-terminate.

	* same.c (STREQ): Remove.
	(same_name): Handle the case where the basename ends in trailing '/'.

	* stripslash.c (strip_trailing_slashes): Return nonzero if
	a slash was stripped.  Do not strip the last slash after a
	file system prefix.

2001-04-08  Jim Meyering  <meyering@lucent.com>

	* getdate.y (get_date): Set tm_isdst to -1 to ensure that it is
	recomputed; that's necessary when the offset spans a DST transition.
	Patch by David J. MacKenzie.  Reported by Hon-Yin Kok.

2001-04-02  Jim Meyering  <meyering@lucent.com>

	* regex.h, regex.c: Update from GNU libc.

2001-03-19  Paul Eggert  <eggert@twinsun.com>

	* version-etc.c (version_etc_copyright): Update to 2001.

2001-03-16  Paul Eggert  <eggert@twinsun.com>

	* tempname.c (uint64_t): Define to uintmax_t if
	not defined, and if UINT64_MAX is not defined.
	Required at least for Vax Ultrix4.3, which doesn't define uint64_t.
	Reported by John David Anglin.

2001-03-10  Bruno Haible  <haible@clisp.cons.org>

	* localcharset.c (locale_charset): Allow wildcard syntax. Also resolve
	alias if codeset is empty.
	* config.charset (BeOS): Use wildcard syntax.

2001-03-13  Jim Meyering  <meyering@lucent.com>

	* path-concat.c (path_concat) [FILESYSTEM_ACCEPTS_DRIVE_LETTER_PREFIX]:
	Don't insert a backslash when concatenating e.g., `C:' and `foo'.
	From Bruno Haible.

2001-03-06  Bruno Haible  <haible@clisp.cons.org>

	* localcharset.c (locale_charset): Don't use setlocale(LC_CTYPE,NULL).
	Don't return NULL.
	* unicodeio.c (print_unicode_char): Simplify accordingly.

2001-03-06  Bruno Haible  <haible@clisp.cons.org>

	* config.charset: Update for FreeBSD 4.2 and OSF/1 5.1. Add
	support for DOS/DJGPP.

2001-02-28  Paul Eggert  <eggert@twinsun.com>

	* Makefile.am (libfetish_a_SOURCES):
	Add dup-safer.c, fopen-safer.c.
	(noinst_HEADERS): Add stdio-safer.h, unistd-safer.h.

	* dup-safer.c, fopen-safer.c, stdio-safer.h, unistd-safer.h: New files.

2001-02-25  Paul Eggert  <eggert@twinsun.com>

	The mkstemp replacement is taken from glibc 2.2.2, with some
	portability fixes for use outside glibc, as follows:

	* tempname.c (struct_stat64): New macro.
	(direxists, __gen_tempname): Use it.
	This avoids a portability problem with Solaris 8.

	* tempname.c (<config.h>): Include if HAVE_CONFIG_H.
	(<stddef.h>, <stdint.h>, <string.h>):
	Include only if STDC_HEADERS || _LIBC.
	(<fcntl.h>): Include only if HAVE_FCNTL_H || _LIBC.
	(<unistd.h>): Include only if HAVE_UNISTD_H || _LIBC.
	(<sys/time.h>): Include only if HAVE_SYS_TIME_H || _LIBC.
	(__set_errno): Define this macro if <errno.h> doesn't.
	(P_tmpdir, TMP_MAX, __GT_FILE, __GT_BIGFILE, __GT_DIR, __GT_NOCREATE):
	Define these macros if <stdio.h> doesn't.
	(S_ISDIR, S_IRUSR, S_IWUSR, S_IXUSR):
	Define these macros if <sys/stat.h>
	doesn't.  Ignore <sys/stat.h> S_ISDIR if STAT_MACROS_BROKEN.
	(stat64, __getpid, __gettimeofday, __mkdir, __open, __open64, lxstat64,
	__xstat64): Define if not _LIBC.
	(__secure_getenv): Define if ! (HAVE___SECURE_GETENV || _LIBC).
	(__gen_tempname): Invoke gettimeofday only if
	HAVE_GETTIMEOFDAY || _LIBC;
	otherwise, fall back on plain "time".
	Use macros like S_IRUSR | S_IWUSR rather than octal values like 0600.

	* mkstemp.c (__GT_FILE): Define to zero if not defined.

	* mkstemp.c, tempname.c: New files, taken from glibc 2.2.2.

2001-02-17  Jim Meyering  <meyering@lucent.com>

	* strtoul.c: Sync from GNU libc.  Use double quotes, not <...>
	around included file name.

	* strnlen.c (__strnlen): Merge in a change from GNU libc.

	* strftime.c: Update from GNU libc (the only changes were to comments).

2001-02-13  Bruno Haible  <haible@clisp.cons.org>

	* mbswidth.h (mbswidth): Also define as macro, to avoid prototype clash.

2001-02-17  Paul Eggert  <eggert@twinsun.com>

	* mbswidth.c, quotearg.c (mbrtowc, mbsinit):
	Remove workaround macros for hosts that have mbrtowc but not
	mbstate_t, as we now insist on proper declarations for both
	before using mbrtowc.

2001-02-17  Jim Meyering  <meyering@lucent.com>

	* regex.c: Update from libc.

2001-02-16  Paul Eggert  <eggert@twinsun.com>

	* alloca.c (malloc): Undef before defining, since stdlib.h
	may have defined it.  Needed for Encore Umax-3.0.9.16b systems.
	Reported by Mark Hounschell via Paul Eggert.

2001-01-30  Bruno Haible  <haible@clisp.cons.org>

	* config.charset: Update for FreeBSD 4.2.

2001-01-26  Jim Meyering  <meyering@lucent.com>

	* quotearg.c: Include stddef.h.
	* quote.c: Include stddef.h.
	Reported by Axel Kittenberger.

	* xmalloc.c [HAVE_DONE_WORKING_MALLOC_CHECK]: Enclose error-evoking
	line in double quotes so that it evokes a better diagnostic.
	[HAVE_DONE_WORKING_REALLOC_CHECK]: Likewise.
	Reported by Axel Kittenberger.

2001-01-15  Bruno Haible  <haible@clisp.cons.org>

	* unicodeio.c (print_unicode_char): Cast the second iconv() arg,
	to avoid a warning.  Add back 'const' to inptr.

2001-01-16  Jim Meyering  <meyering@lucent.com>

	* basename.c: Include <stdio.h>, needed by assert on SunOS 4.
	From Bruno Haible.

2001-01-14  Jim Meyering  <meyering@lucent.com>

	* rename.c: New file.  From Volker Borchert.
	Include stdlib.h, string.h or strings.h, and xalloc.h.
	Use strip_trailing_slashes rather than open-coding it.

2001-01-03  Paul Eggert  <eggert@twinsun.com>

	* strftime.c: Sync with glibc time/strftime.c 1.81.

2001-01-03  Jim Meyering  <meyering@lucent.com>

	* unicodeio.c (print_unicode_char): Remove `const' from declaration of
	local `inptr' to avoid warning with some system declarations of iconv.

2000-12-29  Paul Eggert  <eggert@twinsun.com>

	* modechange.c: Do not assume that mode_t uses the
	traditional octal encoding.  E.g. "chmod 1 FOO" should set
	the other-execute bit of FOO even if S_IXOTH != 1.

	(SUID, SGID, SVTX, RUSR, WUSR, XUSR, RGRP, WGRP, XGRP, ROTH,
	WOTH, XOTH, ALLM): New macros.
	(S_ISUID, S_ISGID, S_ISVTX, S_IRUSR, S_IWUSR, S_IXUSR,
	 S_IRGRP, S_IWGRP, S_IXGRP, S_IROTH, S_IWOTH, S_IXOTH):
	Use them.
	(S_ISGID): Fix typo; it was defaulting to the same value as S_ISUID.
	(S_IRWXU, S_IRWXG, S_IRWXO): Specify defaults in terms of the above.
	(mode_compile):
	No need to use uintmax_t; unsigned long is long enough.
	Don't bother to get suffix since we don't use it.

2000-12-24  Jim Meyering  <meyering@lucent.com>

	* hash.c (is_prime): Return explicit boolean values.
	(hash_get_first): Return NULL to appease Irix5.6's 89.
	Reported by Nelson Beebe.

2000-10-31  Bruno Haible  <haible@clisp.cons.org>

	* localcharset.c (locale_charset): Add support for Win32.

2000-12-18  Paul Eggert  <eggert@twinsun.com>

	* physmem.h, physmem.c: New files.

	* Makefile.am (libfetish_a_SOURCES): Add physmem.c.
	(noinst_HEADERS): Add physmem.h.

	* xstrtol.c (__xstrtol): Add undocumented suffixes 'g' and
	't' for compatibility with Solaris 8 sort.

2000-12-18  Bruno Haible  <haible@clisp.cons.org>

	* config.charset: Add support for BeOS.

2000-12-16  Jim Meyering  <meyering@lucent.com>

	* getusershell.c [!SHELLS_FILE && __DJGPP__]: Define
	SHELLS_FILE to a file name that's useful on djgpp systems.
	Include stdlib.h.
	(ADDITIONAL_DEFAULT_SHELLS): Define.
	(default_shells): Prepend ADDITIONAL_DEFAULT_SHELLS.
	Based mostly on a patch from Prashant TR.

2000-12-16  Jim Meyering  <meyering@lucent.com>

	This bug had a serious impact on chown: `chown N:M FILE' (for integer
	N and M) would have treated it like `chown N:N FILE'.

	* userspec.c (parse_user_spec): Fix typo: s/u/g/.

2000-10-31  Bruno Haible  <haible@clisp.cons.org>

	* config.charset: Add ISO-8859-3, BIG5HKSCS, GB18030, JOHAB, VISCII,
	CP874, CP949, CP950, CP1250, CP1253, CP1254, CP1255, CP1256, CP1257
	to the list of canonical encodings. Rename EUC-CN to GB2312.

2000-12-08  Andreas Schwab  <schwab@suse.de>

	* mbswidth.c (mbsnwidth): Don't loop endlessly when called with an
	invalid mulitbyte sequence and with the MBSW_ACCEPT_INVALID flag set.

2000-12-07  Jim Meyering  <meyering@lucent.com>

	* stripslash.c (ISSLASH): Define.
	(strip_trailing_slashes): Use ISSLASH rather than comparing against `/'.
	From Prashant TR.

	* dirname.c (FILESYSTEM_PREFIX_LEN): Define.
	(dir_name_r): Declare this function as static.
	[BACKSLASH_IS_PATH_SEPARATOR]: Fix a bug that'd
	manifest itself on a name containing a mix of slashes and
	backslashes.
	Make this function work with names starting with a DOS-style
	drive letter and colon prefix.
	(dir_name): Append `.' if necessary.
	Based mostly on patches from Prashant TR and Eli Zaretskii.

	* dirname.h (dir_name_r): Remove prototype.

2000-12-05  Jim Meyering  <meyering@lucent.com>

	* dirname.c (dir_name_r): Add `const' in a few local declarations.

2000-12-04  Jim Meyering  <meyering@lucent.com>

	* path-concat.c: [!HAVE_DECL_MALLOC]: Declare malloc.
	Also include memory.h, stdlib.h, unistd.h if appropriate.
	Reported by Andreas Jaeger (conflicting declaration of malloc).

2000-12-02  Jim Meyering  <meyering@lucent.com>

	* closeout.h: Make idempotent, to avoid some obscure warnings.

2000-12-01  Paul Eggert  <eggert@twinsun.com>

	* memrchr.c: Include <config.h> before any system include file.

2000-11-29  Paul Eggert  <eggert@twinsun.com>

	* dirname.c (dir_name_r): Fix typo: int -> size_t.

2000-11-26  Jim Meyering  <meyering@lucent.com>

	* memcoll.c: Include sys/types.h.  From Werner Almesberger.

2000-11-22  Paul Eggert  <eggert@twinsun.com>

	* strftime.c (my_strftime): Do not invoke mbrlen with a
	size of (size_t) -1; it's not portable.

2000-11-17  Akim Demaille  <akim@epita.fr>

	* obstack.h: Formatting changes.
	(obstack_grow, obstack_grow0): Don't cast WHERE at all: that would
	prevent type checking.
	(obstack_ptr_grow, obstack_ptr_grow_fast): When assigning, don't
	cast the value to (void *): assigning a `foo *' to a `void *'
	variable is valid.
	(obstack_int_grow, obstack_int_grow_fast): Don't cast AINT to int.

2000-11-17  Jim Meyering  <meyering@lucent.com>

	* strstr.c: Update from GNU libc.

2000-11-16  Jim Meyering  <meyering@lucent.com>

	* strverscmp.c: Incorporate weak-alias-related changes from glibc.

2000-11-11  Jim Meyering  <meyering@lucent.com>

	* error.c: Add a couple #includes, merging from GNU libc version.

2000-11-10  Jim Meyering  <meyering@lucent.com>

	* obstack.h: Update from GNU libc.
	* obstack.c: Likewise.

2000-11-06  Paul Eggert  <eggert@twinsun.com>

	* getusershell.c (setusershell): Use rewind rather than
	fseek/fseeko, to avoid configuration hassles with fseeko.
	Don't bother opening SHELLS_FILE if shellstream is NULL;
	it's not necessary.

2000-11-05  Jim Meyering  <meyering@lucent.com>

	* makepath.h (make_dir): Declare.
	* makepath.c (make_dir): Remove `static' attribute.
	Tweak a comment.

2000-11-04  Alexandre Duret-Lutz  <duret_g@epita.fr>

	* hash.c (hash_get_next): Fix a thinko:  when ENTRY is the
	last one in a bucket, advance to the next bucket.

2000-11-02  Vesselin Atanasov  <vesselin@bgnet.bg>

	* fnmatch.c: Do not comment out all the code if we are using
	the GNU C library, because in some cases we are replacing buggy
	code in the GNU C library itself.

2000-10-30  Paul Eggert  <eggert@twinsun.com>

	* error.h, getline.h, modechange.h:
	Remove "2000" from Copyright line, as the file hasn't been
	changed this year other than in the copyright notice.

	* xalloc.h: Add "2000" to Copyright line, as this file
	was changed this year.

2000-10-30  Paul Eggert  <eggert@twinsun.com>

	* fnmatch.c (FOLD): Do not assume that characters are unsigned.
	(fnmatch): Fix some FNM_FILE_NAME and FNM_LEADING_DIR bugs,
	e.g. fnmatch("d*/*1", "d/s/1", FNM_FILE_NAME) incorrectly yielded zero.

2000-10-29  Greg Louis  <glouis@dynamicro.on.ca>

	* regex.h (__restrict_arr): Move definition out of #ifndef block.
	Required because egcs-2.91.66 (aka 1.1.2) defines __restrict, but
	doesn't define __restrict_arr.

2000-10-29  Jim Meyering  <meyering@lucent.com>

	* xstat.in: Fix grammar in comment.

2000-10-28  Jim Meyering  <meyering@lucent.com>

	* memchr.c: Update from libc.
	Adjust for portability:
	[HAVE_STDLIB_H]: Include stdlib.h.
	[HAVE_BP_SYM_H || _LIBC]: Guard inclusion of bp-sym.h.
	Undef __memchr, too.
	[!weak_alias]: Define __memchr to memchr.

	* regex.c: Update from libc.
	* regex.h: Likewise.
	* getopt1.c: Likewise.
	* memcmp.c: Likewise.

	* getusershell.c (setusershell) [HAVE_FSEEKO]: Use fseeko.
	Avoid using fseek, when possible -- it's broken by design.
	Patch by Ulrich Drepper.

2000-10-26  Jim Meyering  <meyering@lucent.com>

	* strftime.c: Update from libc.

2000-10-25  Jim Meyering  <meyering@lucent.com>

	* obstack.c: Update from libc.

2000-10-23  Jim Meyering  <meyering@lucent.com>

	* hard-locale.c (hard_locale): Revert last change -- it was simply
	wrong.  That set_locale call must not have any side effects.
	From Paul Eggert.

2000-10-22  Jim Meyering  <meyering@lucent.com>

	* md5.c (md5_process_block) [OP]: Use `rol', not CYCLIC.
	[CYCLIC]: Remove now-unused definition.

	* save-cwd.c (O_DIRECTORY): Define, if needed.
	(save_cwd) [HAVE_FCHDIR]: Use O_DIRECTORY when opening ".".
	Suggestion from Ulrich Drepper.

2000-10-21  Jim Meyering  <meyering@lucent.com>

	* dirname.c (dir_name_r): New function, factored out of dir_name.
	(dir_name): Use dir_name_r.
	* dirname.h (dir_name_r): Declare it.

2000-10-21  Jim Meyering  <meyering@lucent.com>

	* dirname.c (memrchr): Declare if necessary.
	(dir_name): Remove the restriction that there be no
	trailing slashes.  Now, this code skips past them, effectively
	ignoring them.
	[TEST_DIRNAME] (main): New unit tests.

	* memrchr.c: New file from GNU libc.
	Undef __memrchr, too.
	[!weak_alias]: Define __memrchr to memrchr.
	Guard weak_alias use with `#ifdef weak_alias'.

2000-10-17  Jim Meyering  <meyering@lucent.com>

	* quote.h (PARAMS): Define and use.
	Reported by Akim Demaille.

	* getopt.c: Update from libc.

2000-10-16  Jim Meyering  <meyering@lucent.com>

	* hard-locale.c (hard_locale): Use "", not 0 as 2nd arg to setlocale.
	From Jan Fedak.

2000-09-25  Jim Meyering  <meyering@lucent.com>

	* md5.h (rol): Define (from GnuPG).

	* sha.c: Give credit (GnuPG) where due.
	(M): Use rol rather than open-coding it.
	Add a FIXME comment.

2000-09-21  Jim Meyering  <meyering@lucent.com>

	* userspec.c (parse_user_spec): Remove debugging printf I'd added.
	Reported by Michael Stone.

2000-09-20  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (libfetish_a_SOURCES): Add sha.c.
	(noinst_HEADERS): Add sha.h.
	Based on code from Scott G. Miller and from GnuPG.

2000-09-15  Jim Meyering  <meyering@lucent.com>

	* regex.c: Update from libc.

2000-09-10  Jim Meyering  <meyering@lucent.com>

	* getopt.c (_getopt_internal): Update from glibc.

2000-09-09  Jim Meyering  <meyering@lucent.com>

	* quotearg.c: Rename ISASCII to IN_CTYPE_DOMAIN, so people don't
	think it should be used as a general replacement for isascii.
	* fnmatch.c: Likewise.
	* mbswidth.c: Likewise
	* regex.c: Likewise.

	Don't use atoi.
	* userspec.c: Include sys/param.h and limits.h.
	Include xstrtol.h.
	(CHAR_BIT, TYPE_SIGNED, TYPE_MINIMUM, TYPE_MAXIMUM): Define.
	(UID_T_MAX, GID_T_MAX, MAXUID, MAXGID): Define.
	(parse_user_spec): Use xstrtoul, not atoi when converting numeric
	UID, GID.  Check range.

2000-09-06  Jim Meyering  <meyering@lucent.com>

	* getopt.c (_getopt_internal): Update from glibc.

2000-08-30  Jim Meyering  <meyering@lucent.com>

	* strftime.c: Merge in changes from GNU libc.

2000-08-26  Jim Meyering  <meyering@lucent.com>

	* closeout.c: Include "__fpending.h".
	(close_stdout_status): Return right away if there's nothing to flush.

	* Makefile.am (noinst_HEADERS): Add __fpending.h.
	* __fpending.c: New file.
	* __fpending.h: New file.

2000-08-07  Paul Eggert  <eggert@twinsun.com>

	Standardize on "memory exhausted" instead of "Memory exhausted"
	or "virtual memory exhausted".
	* obstack.c (print_and_abort): Use "memory exhausted", not
	"virtual memory exhausted".
	* same.c (same_name): Invoke xalloc_die instead of printing
	our own message.
	* userspec.c (parse_user_spec): Likewise.
	* bumpalloc.h: comment fix
	* same.c, userspec.c: Include xalloc.h.

	* xalloc.h (xalloc_msg_memory_exhausted): Now char const[],
	not char *const and pointing to a constant array.
	* xmalloc.c (xalloc_msg_memory_exhausted): Likewise.
	(xrealloc): Comment fix.

	* userspec.c (parse_user_spec):
	Don't translate a message until just before returning,
	to avoid unnecessary translation.

2000-08-07  Jim Meyering  <meyering@lucent.com>

	* addext.c, argmatch.c, argmatch.h, backupfile.h, bumpalloc.h,
	chown.c, diacrit.h, dirname.h, dup2.c, exclude.h, fileblocks.c,
	fnmatch.c, fnmatch.h, fsusage.c, fsusage.h, getdate.h,
	getgroups.c, gethostname.c, getopt.h, group-member.c,
	hard-locale.c, hash.h, isdir.c, lchown.c, linebuffer.c,
	linebuffer.h, long-options.h, malloc.c, md5.c, md5.h, memchr.c,
	memcmp.c, memcoll.c, memset.c, mktime.c, modechange.h, obstack.h,
	pathmax.h, realloc.c, rmdir.c, safe-read.c, save-cwd.c, stime.c,
	stpcpy.c, strcasecmp.c, strcspn.c, strdup.c, stripslash.c,
	strstr.c, strtod.c, strtol.c, strtoul.c, strtoull.c, strtoumax.c,
	utime.c, version-etc.h, xalloc.h, xstrdup.c, xstrtoumax.c,
	yesno.c: Back out Copyright date changes for each file with no change
	this year.  This eases coordination with other programs using the same
	source code modules.  From Paul Eggert.

2000-08-03  Greg McGary  <greg@mcgary.org>

	* regex.c (SET_HIGH_BOUND, MOVE_BUFFER_POINTER,
	ELSE_EXTEND_BUFFER_HIGH_BOUND): New macros.
	(EXTEND_BUFFER): Use them.

2000-08-01  Jim Meyering  <meyering@lucent.com>

	* dirname.c (ISSLASH): Define.
	(BACKSLASH_IS_PATH_SEPARATOR): Define.
	(dir_name) [BACKSLASH_IS_PATH_SEPARATOR]: Handle the case in which
	both `\' and `/' may be use as path separators.
	Based on a patch from Prashant TR.

2000-07-31  Paul Eggert  <eggert@twinsun.com>

	* quotearg.c (quotearg_n_options): Don't make the initial
	slot vector a constant, since it might get modified.

2000-07-31  Jim Meyering  <meyering@lucent.com>

	* xmalloc.c: Use `virtual memory exhausted', not `Memory exhausted'.
	* obstack.c (print_and_abort): Likewise.

2000-07-30  Paul Eggert  <eggert@twinsun.com>

	* quotearg.c (quotearg_n_options): Preallocate a slot 0
	buffer, so that the caller can always quote one small
	component of a "memory exhausted" message in slot 0.
	From a suggestion by Jim Meyering.

2000-07-30  Jim Meyering  <meyering@lucent.com>

	* makepath.c (make_path): Quote the other instance, too.

	* quotearg.c (N_STATIC_SLOTVECS): Define.
	(STATIC_BUF_SIZE): Define.
	(quotearg_n_options): Use only statically allocated storage when
	N < N_STATIC_SLOTVECS and the length of the quoted result is smaller
	than STATIC_BUF_SIZE.

2000-07-29  Jim Meyering  <meyering@lucent.com>

	* diacrit.c (diacrit_diac): Use __MSDOS__ in favor of MSDOS.
	* dirname.c (dir_name): Likewise.

	* basename.c (base_name): Use ISSLASH rather than comparing against `/'.

	* dirname.c (dir_name) [MSDOS]: Declare `lim' to be const.
	(dir_name): Assert that there are no trailing slashes.

2000-07-18  Bruno Haible  <haible@clisp.cons.org>

	* mbswidth.h (mbswidth): Add a flags argument.
	(mbswidth): New declaration.
	(MBSW_ACCEPT_INVALID, MBSW_ACCEPT_UNPRINTABLE): New macros.
	* mbswidth.c (mbswidth): Add a flags argument.
	(mbsnwidth): New function.

2000-07-24  Jim Meyering  <meyering@lucent.com>

	* mbswidth.c: Remove useless #else.  From Bruno Haible.

2000-07-23  Paul Eggert  <eggert@twinsun.com>

	* mbswidth.c (_XOPEN_SOURCE):
	Don't define; this causes problems on Solaris 7.
	(wcwidth) [!HAVE_DECL_WCWIDTH]: Declare.

2000-07-23  Paul Eggert  <eggert@twinsun.com>

	* quotearg.c:
	Include <wchar.h> even if ! (HAVE_MBRTOWC && 1 < MB_LEN_MAX),
	so that mbstate_t is always defined.

	Do not inspect MB_LEN_MAX, since it's incorrectly defined to
	be 1 in at least one GCC installation, and this configuration
	error is likely to be common.  Ignoring MB_LEN_MAX hurts
	performance on hosts that have mbrtowc but have only unibyte
	locales, but I assume these hosts are rare.

2000-07-23  Paul Eggert  <eggert@twinsun.com>

	* quotearg.c: Streamline by invoking multibyte code only if needed.
	<wchar.h>: Include only if HAVE_MBRTOWC && 1 < MB_LEN_MAX.
	(MB_CUR_MAX): Redefine to 1 if ! (HAVE_MBRTOWC && 1 < MB_LEN_MAX).
	(quotearg_buffer_restyled): If a unibyte locale, don't bother to
	invoke multibyte primitives.

2000-07-23  Jim Meyering  <meyering@lucent.com>

	* basename.c (base_name): Add an assertion.

2000-07-15  Bruno Haible  <clisp.cons.org>

	* quotearg.c: When the system forces us to redefine mbstate_t,
	shadow its mbsinit function.

2000-07-16  Bruno Haible  <haible@clisp.cons.org>

	* mbswidth.h: New file.
	* mbswidth.c: New file.
	* Makefile.am (libfetish_a_SOURCES): Add mbswidth.c.
	(noinst_HEADERS): Add mbswidth.h.

2000-07-17  Bruno Haible  <haible@clisp.cons.org>

	* config.charset: Add support for FreeBSD. Improve support for HP-UX
	and IRIX 6.

2000-07-15  Jim Meyering  <meyering@lucent.com>

	* makepath.c: Include quote.h.
	(make_path): Convert "`%s'" in format strings to "%s", and wrap each
	corresponding argument in a `quote (...)' call.
	Give better diagnostics.

	* Makefile.am (libfetish_a_SOURCES): Add quote.c.
	(noinst_HEADERS): Add quote.h.

	* quote.c (quote, quote_n): New file.  Two functions taken verbatim
	from tar's src/misc.c.
	* quote.h: New file.  Prototypes for same.

2000-07-10  Paul Eggert  <eggert@twinsun.com>

	From a suggestion by Bruno Haible.
	* quotearg.c (mbrtowc): Do not use HAVE_WCHAR_H in the definition.
	Use defined mbstate_t, not HAVE_MBSTATE_T_OBJECT,
	to decide whether to define the BeOS workaround macro;
	this adjusts to the change to AC_MBSTATE_T.

2000-07-13  Paul Eggert  <eggert@twinsun.com>

	* quotearg.h (enum quoting style): New enum clocale_quoting_style.

	* quotearg.c (quoting_style_args, quoting_style_vals,
	quotearg_buffer_restyled): Add support for
	clocale_quoting_style.  Undo previous change to
	locale_quoting_style behavior, and undo the "{LEFT QUOTATION MARK}"
	and "{RIGHT QUOTATION MARK}" msgids.

2000-07-05  Paul Eggert  <eggert@twinsun.com>

	The old behavior of quoting `like this' doesn't look good with
	newer, ISO-style fonts.  See:
	http://www.cl.cam.ac.uk/~mgk25/ucs/quotes.html

	Instead, quote "like this" by default.  Let the translator
	tailor the locale-specific quoting behavior by providing
	translations for {LEFT QUOTATION MARK} and {RIGHT QUOTATION MARK}.

	* quotearg.c (N_): New macro.
	(gettext_default): New function.
	(quotearg_buffer_restyled): Use
	gettext_default ("{LEFT QUOTATION MARK}", "\"") for left quote, and
	gettext_default ("{RIGHT QUOTATION MARK}", "\"") for right quote.

2000-07-09  Jim Meyering  <meyering@lucent.com>

	* Most files: Update copyright dates to include 2000.

2000-07-08  Jim Meyering  <meyering@lucent.com>

	* xgethostname.c (ENAMETOOLONG): Define to an unlikely value
	if not defined.
	(xgethostname): Remove now-unnecessary #ifdef.
	Move declaration of `err' into loop where it's used.

2000-07-05  Bruno Haible  <haible@clisp.cons.org>

	* xgethostname.c (xgethostname): Protect against the SunOS 5.5 bug
	by allocating a larger buffer. Test the gethostname return value for
	being >= 0, not == 0, for BeOS.  Don't exhaust memory if gethostname
	returns an error and ENAMETOOLONG isn't defined.

2000-07-05  Paul Eggert  <eggert@twinsun.com>
	and Bruno Haible  <haible@clisp.cons.org>

	* quotearg.c (mbrtowc): Declare returned type, since BeOS doesn't.

2000-07-05  Bruno Haible  <haible@clisp.cons.org>

	* quotearg.c (struct quoting_options): Simplify quote_these_too
	dimension.

2000-07-03  Jim Meyering  <meyering@lucent.com>

	* strndup.c: [!HAVE_DECL_STRNLEN]: Declare strnlen.
	Reported by Bruno Haible.

2000-07-04  Jim Meyering  <meyering@lucent.com>

	* quotearg.c: Make inclusion of <wchar.h> independent of whether
	HAVE_MBRTOWC is set.  Required at least for irix-5.6, which
	lacks mbrtowc.

2000-07-03  Paul Eggert  <eggert@twinsun.com>
	and Bruno Haible  <haible@clisp.cons.org>

	* quotearg.c (mbrtowc):
	Assign to *pwc, and return 1 only if result is nonzero.
	(iswprint): Use ISPRINT when substituting our own mbrtowc.

2000-07-03  Jim Meyering  <meyering@lucent.com>

	* readutmp.h: [HAVE_UTMPX_H]: Include <utmp.h> if HAVE_UTMP_H.
	This is necessary to get a definition of e.g., UTMP_FILE on HP-UX 10.20.
	From Bob Proulx.

2000-07-02  Jim Meyering  <meyering@lucent.com>

	* quotearg.c (mbstate_t): Don't define here.

2000-07-02  Jim Meyering  <meyering@lucent.com>

	* nanosleep.c (SIGCONT): Define if not already defined.

2000-06-17  Bruno Haible  <haible@clisp.cons.org>

	* mountlist.c: Use MOUNTED_FS_STAT_DEV instead of MOUNTED_NEXT_DEV,
	per change in ../m4/ls-mntd-fs.m4.
	(read_filesystem_list): Ignore symbolic links.

2000-06-29  Jim Meyering  <meyering@lucent.com>

	* same.c: Include <string.h> or <strings.h>, as appropriate,
	for declaration of strcmp.

	* long-options.c: Include <stdlib.h>, for declaration of exit.

	* mountlist.c (fsp_to_string) [HAVE_F_FSTYPENAME_IN_STATFS]:
	Avoid warning by casting result to `char *' to remove `const'.

2000-06-17  Bruno Haible  <haible@clisp.cons.org>

	* Makefile.am (libfetish_a_SOURCES): Remove readutmp.c.

2000-06-26  Paul Eggert  <eggert@twinsun.com>

	savedir now sets errno on failure and invokes xmalloc to get memory.
	Fix a couple of other minor bugs while we're at it.

	* savedir.c (<unistd.h>): Do not include; there's no need.
	(NAMLEN): Remove macro.
	(malloc, realloc): Remove decls.
	(stpcpy): Likewise.
	("xalloc.h"): Include.
	(NAME_SIZE_DEFAULT): New macro.
	(savedir): Use xmalloc / xrealloc to allocate memory.
	Use NAME_SIZE_DEFAULT if name_size is negative or overflows to zero.
	Skip "" directory entries.
	Use strlen to calculate directory entry length, since the old method
	is rarely used these days and isn't worth supporting.
	Don't use a pointer after freeing it.
	Check for integer overflow when calculating allocation size.
	Use memcpy to copy entries, instead of stpcpy.
	Set errno properly when returning NULL.
	Check for readdir error.

2000-06-26  Jim Meyering  <meyering@lucent.com>

	* posixtm.c [HAVE_STDLIB_H]: Include stdlib.h, for decl of abort.

2000-06-17  Bruno Haible  <haible@clisp.cons.org>

	* getusershell.c (xmalloc, xrealloc): Remove functions.
	Include xalloc.h.
	Don't include <stdlib.h>.  Don't declare malloc, realloc.

2000-06-23  Bruno Haible  <haible@clisp.cons.org>

	* unicodeio.c (print_unicode_char): Work around ansi2knr deficiency.

2000-06-24  Jim Meyering  <meyering@lucent.com>

	* error.c [!HAVE_DECL_STRERROR_R]: Declare strerror_r.

2000-06-21  Jim Meyering  <meyering@lucent.com>

	* getpass.c: New file, from Bruno Haible.  Required for BeOS.

2000-06-19  Paul Eggert  <eggert@twinsun.com>

	* quotearg.c: Include <wctype.h> after <wchar.h>, for Solaris 2.5.
	(mbrtowc, mbstate_t): Define substitutes if
	HAVE_MBRTOWC && HAVE_WCHAR_H && !HAVE_MBSTATE_T_OBJECT.
	(iswprint): Define to 1 if !defined iswprint && !HAVE_ISWPRINT,
	not if ! (HAVE_MBRTOWC && HAVE_WCHAR_H).

2000-06-17  Bruno Haible  <haible@clisp.cons.org>

	* xgetcwd.c (xgetcwd): If the required pathname length is smaller
	than 1024, return a memory chunk of least possible size, instead
	of size PATH_MAX + 2. In the loop, increment the size proportionally.
	Use free/xmalloc instead of xrealloc to avoid copying for very long
	paths.

2000-06-17  Bruno Haible  <haible@clisp.cons.org>

	* canon-host.c (canon_host): Use malloc and memcpy to copy an
	address, not strdup.  Include <stdlib.h> and don't declare free().

2000-06-17  Bruno Haible  <haible@clisp.cons.org>

	* path-concat.c (path_concat): Don't access dir[-1] if dir is
	the empty string.

2000-06-21  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (libfetish_a_SOURCES): Add getstr.c.
	(noinst_HEADERS): Add getstr.h.

	* getline.c (getstr): Move into a separate file.
	* getstr.c (getstr): New file, extracted from getline.c, with
	the following changes: new parameter, delim2; both delim[12]
	parameters have type `int', not `char'.  The latter would lose
	with 8-bit delimiters.
	* getstr.h: New file.

2000-06-19  Jim Meyering  <meyering@lucent.com>

	* getloadavg.c [HAVE_NLIST_H] (NLIST_STRUCT): Define.

2000-06-18  Jim Meyering  <meyering@lucent.com>

	* mkdir.c: Remove file, due mainly to copyright incompatibility.
	Besides, these days every porting target provides a mkdir function.

	* strnlen.c: Include memory.h, string.h, and/or strings.h as needed.
	(this snippet comes from src/system.h).

2000-06-15  Paul Eggert  <eggert@twinsun.com>

	* human.c (adjust_value): New function.
	(human_readable_inexact): Apply rounding style even when
	printing approximate values.

2000-06-14  Paul Eggert  <eggert@twinsun.com>

	* human.c (human_readable_inexact): Allow an input block
	size that is not a multiple of the output block size, and vice versa.
	Reported by Piergiorgio Sartor.

2000-06-14  Paul Eggert  <eggert@twinsun.com>

	* getdate.y (get_date): Apply relative times after time
	zone indicator, not before.  Reported by Todd A. Jacobs.

2000-06-13  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (all-local): Depend on lstat.c and stat.c.

	* xstat.in [!HAVE_DECL_FREE]: Declare free in lstat.c.

2000-06-12  Paul Eggert  <eggert@twinsun.com>

	* xstat.in: Include <stdlib.h> in lstat, to declare "free".

2000-06-04  Paul Eggert  <eggert@twinsun.com>

	* strnlen.c: Include <config.h> if HAVE_CONFIG_H.

2000-06-04  Jim Meyering  <meyering@lucent.com>

	* getugroups.c (getugroups): Cast -1 to gid_t, for systems like
	SunOS 4.1.4 for which gid_t is an unsigned type.

2000-06-03  Jim Meyering  <meyering@lucent.com>

	* strnlen.c [!HAVE_DECL_MEMCHR]: Declare memchr.

2000-05-26  Bruno Haible  <haible@clisp.cons.org>

	* Makefile.am (install-exec-local): On systems with glibc-2.1 or
	newer, don't install charset.alias.
	* config.charset: Change the Linux/glibc rules so they become empty
	on glibc-2.1 or newer.

2000-06-02  Jim Meyering  <meyering@lucent.com>

	* mountlist.c: Back out last change.  Instead, do this...
	* mountlist.c (read_filesystem_list) [MOUNTED_VMOUNT]: Set the me_dummy
	member using the same `ignore'-testing code.
	* mountlist.h (ME_DUMMY): Add `autofs' to the list of ignored
	fs_type strings.
	From Mark D. Roth.

2000-05-29  Jim Meyering  <meyering@lucent.com>

	* mountlist.c (read_filesystem_list) [MOUNTED_VMOUNT]: Ignore mounts
	with the `ignore' attribute.  Based on a patch from Mark D. Roth.

2000-05-22  Jim Meyering  <meyering@lucent.com>

	* makepath.c: Remove old, now-unnecessary `#ifdef __MSDOS__' block.

2000-05-18  Jim Meyering  <meyering@lucent.com>

	* hash.c (hash_rehash): Fix a nasty bug: copy the free entry list
	back, too, since it may have been modified by allocate_entry.
	(hash_delete): Rewrite to use neither the assignment operator
	nor the comma operator in an if-expression.

2000-05-15  Paul Eggert  <eggert@twinsun.com>

	* closeout.c:
	<sys/stat.h>, <sys/types.h>, <unistd.h>, (STDOUT_FILENO):
	Remove; no longer needed.
	"quotearg.h": Add include.
	(file_name): Do not bother to explicitly initialize to NULL; it's less
	efficient on some hosts.
	(close_stdout_status): Remove test as to whether stdout was already
	closed; it breaks for the case "echo x | sort >&-".
	Quote file name colons.
	Do not assume that _("write error") lacks format strings.

2000-05-15  Jim Meyering  <meyering@lucent.com>

	* version-etc.c (version_etc_copyright): Update the copyright string
	used in all --version output.

2000-05-14  Jim Meyering  <meyering@lucent.com>

	* closeout.c (close_stdout_set_file_name): New function.
	(close_stdout_status): Use new file-scoped global.
	Return right away if fstat says the stdout file descriptor is invalid.
	* closeout.h (close_stdout_set_file_name): Declare.

2000-05-10  Jim Meyering  <meyering@lucent.com>

	* closeout.c [default_exit_status]: New file-scoped variable.
	(close_stdout_set_status): New function.
	* closeout.h (close_stdout_set_status): Declare.

2000-05-08  Jim Meyering  <meyering@lucent.com>

	* long-options.c: Don't include closeout.h.
	(parse_long_options): Don't call close_stdout for --version.

2000-05-06  Jim Meyering  <meyering@lucent.com>

	* strnlen.c: Undefine __strnlen and strnlen.
	[!weak_alias]: Define __strnlen to strnlen.

	* atexit.c: New file, from libiberty.

2000-05-06  Jim Meyering  <meyering@lucent.com>

	* closeout.c (close_stdout_status): Also check for errors on the
	stderr stream.

2000-05-05  Bruno Haible  <haible@clisp.cons.org>

	* localcharset.c (get_charset_aliases): Use malloc, realloc and memcpy
	instead of xmalloc, xrealloc, path_concat.
	(locale_charset): Treat empty environment variables as absent.
	(DIRECTORY_SEPARATOR, ISSLASH): New macros.

2000-05-04  Jim Meyering  <meyering@lucent.com>

	* getopt.c: Update from glibc.
	* obstack.c: Likewise.
	* obstack.h: Likewise.
	* regex.c: Likewise.  NB: K&R compiler support is dropped for this file

	* regex.h: Likewise.
	* strndup.c: Likewise.
	* strnlen.c: New file, from glibc.

2000-05-01  Jim Meyering  <meyering@lucent.com>

	* full-write.c (full_write): Remove `FIXME' part of comment.

2000-04-29  Jim Meyering  <meyering@lucent.com>

	* path-concat.c: Declare strdup only if it's not defined.
	* canon-host.c: Likewise.

2000-04-28  Jim Meyering  <meyering@lucent.com>

	* rpmatch.c [HAVE_LIMITS_H]: Include limits.h before regex.h to avoid
	redefinition warning on some systems (HPUX).  Otherwise, regex.h is
	included first, then limits.h is included by locale.h by libintl.h.
	From John David Anglin.

2000-04-25  Jim Meyering  <meyering@lucent.com>

	* makepath.c (S_IRWXUGO): Define.
	(make_path): Always perform explicit chmod if MODE specifies any
	of the `special' permission bits.  Prompted by a bug report against
	install from Mate Wierdl and Joost van Baal.

2000-04-18  Jim Meyering  <meyering@lucent.com>

	* README: New file.

	* getpagesize.h [!getpagesize && HAVE_OS_H && B_PAGE_SIZE]: Define
	getpagesize.  For BeOS.  Based on a patch from Bruno Haible.

2000-04-17  Jim Meyering  <meyering@lucent.com>

	* strftime.c (my_strftime) [strftime]: Declare strftime here, since
	the definition of it to rpl_strftime also defined-away the system's
	declaration.

2000-04-15  Jim Meyering  <meyering@lucent.com>

	Use `C' to denote so-called `contiguous' files, the same way
	that tar does.
	* filemode.c (S_ISCTG) [!S_ISCTG && S_IFCTG]: Define.
	(ftypelet): Use S_ISCTG.
	From Michael Deutschmann.

2000-04-14  Jim Meyering  <meyering@lucent.com>

	* strftime.c (my_strftime) [#ifdef strftime]: Declare strftime.

2000-04-08  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (charset.alias): Use t-$@, not $@-t so the DOS 8.3
	names don't conflict.  Reported by Eli Zaretskii.

2000-03-28  Bruno Haible  <haible@clisp.cons.org>

	* unicodeio.c (print_unicode_char): Avoid triggering Solaris iconv
	bug.  Deal with the different error behavior of Irix iconv.

2000-04-07  Jim Meyering  <meyering@lucent.com>

	* putenv.c: Move inclusion of errno.h so it follows that of sys/types.h,
	to work around system header problems on AIX 3.2.5.  From Bruno Haible.

2000-04-05  Jim Meyering  <meyering@lucent.com>

	Portability tweaks required for ultrix4.3.
	* readutmp.h [HAVE_UTMPX_H && !HAVE_DECL_GETUTENT]: Declare getutent.
	* readutmp.c: Include sys/types.h before sys/stat.h.
	* canon-host.c: Declare strdup.
	* path-concat.c: Likewise.
	From John David Anglin.

2000-04-04  Jim Meyering  <meyering@lucent.com>

	Be more DOS 8.3-friendly.
	* ref-add.sin: Renamed from ref-add.sed.in.
	* ref-del.sin: Renamed from ref-del.sed.in.
	* Makefile.am: Reflect renaming.
	Reported by Eli Zaretskii.

	Use a temporary file name that won't clash with `charset.alias'
	in the DOS 8.3 name space.
	* Makefile.am (charset_tmp): Define.
	(install-exec-local): Use $(charset_tmp) instead of $(charset_alias)-t.
	(uninstall-local): Likewise.
	Reported by Eli Zaretskii.

2000-03-29  Paul Eggert  <eggert@twinsun.com>

	* time/strftime.c (my_strftime): Make sure we call the system
	strftime, not ourselves, when invoking the underlying strftime.

2000-03-24  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (EXTRA_DIST): Add ref-add.sed.in and ref-del.sed.in.
	(charset_alias): Define.
	(install-exec-local): Factor out common code.
	(uninstall-local): Split lines longer than 80.
	(ref-add.sed, ref-del.sed): Remove rules... (do the following instead)
	(SUFFIXES): Define.
	(.sed.in.sed): New rule.  Don't redirect directly to $@.
	(CLEANFILES): Add ref-add.sed and ref-del.sed.

2000-03-19  Bruno Haible  <haible@clisp.cons.org>

	* config.charset: Output a line containing "Packages using this file".
	* ref-add.sed.in, ref-del.sed.in: New files.
	* Makefile.am (install-exec-local, uninstall-local, ref-add.sed,
	ref-del.sed): New rules.

2000-03-17  Jim Meyering  <meyering@lucent.com>

	* unicodeio.c (<string.h>): Include only #if HAVE_STRING_H.
	Otherwise, include <strings.h>

2000-03-17  Bruno Haible  <haible@clisp.cons.org>

	* unicodeio.c (utf8_wctomb): New function.
	(print_unicode_char): Pass the Unicode character to iconv in UTF-8
	format instead of in UCS-4 with platform dependent endianness.

2000-03-07  Paul Eggert  <eggert@twinsun.com>

	* savedir.c (savedir): Work even if directory size is
	negative; this can happen with some screwy NFS configurations.

2000-03-06  Jim Meyering  <meyering@lucent.com>

	* localcharset.c (get_charset_aliases): Don't try to free file_name
	if it's NULL (because we ran out of memory).  From Bruno Haible.

2000-03-05  Jim Meyering  <meyering@lucent.com>

	* localcharset.c ("path-concat.h"): Include.
	(get_charset_aliases): Use path_concat instead of ANSI string
	concatenation.

	* unicodeio.h (PARAMS): Define.
	Use it to guard prototype.

2000-03-04  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (install-exec-local): Create $(libdir) before installing
	into it.
	(uninstall-local): Uncomment this rule so `make distcheck' works
	once again.

	* unicodeio.c (<errno.h>): Include it.
	(errno): Declare if not defined.

	* localcharset.c: Add Bruno's comment justifying use of volatile.

	* config.charset: New version, incorporating remarks from a linux
	i18n mailing list.  From Bruno Haible.

2000-03-02  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (EXTRA_DIST): Add config.charset.

2000-03-01  Jim Meyering  <meyering@lucent.com>

	* localcharset.c: Guard some #includes with `#if HAVE_...'.
	* unicodeio.c: Likewise.

2000-02-02  Bruno Haible  <haible@clisp.cons.org>

	* config.charset: New file.
	* localcharset.c: New file.
	* unicodeio.h, unicodeio.c: New files.
	* Makefile.am (DEFS): Add -DLIBDIR=...
	(libfetish_a_SOURCES): Add localcharset.c and unicodeio.c.
	(noinst_HEADERS): Add unicodeio.h.
	(all-local, install-exec-local, charset.alias): New targets.

2000-02-28  Paul Eggert  <eggert@twinsun.com>

	* quotearg.c (ALERT_CHAR): New macro.
	(quotearg_buffer_restyled): Use it.

2000-02-27  Jim Meyering  <meyering@lucent.com>

	* strtoumax.c: Fix typo in decl of strtoul: s/long long/long/.
	Guard declaration of strtoull also with `&& HAVE_UNSIGNED_LONG_LONG'.

	* backupfile.c: Guard inclusion of stdlib.h with `#if HAVE_STDLIB_H',
	not `#if STDC_HEADERS'.
	Declare malloc if needed.

	* backupfile.c: Use `#if !HAVE_DECL...' instead of `#ifndef HAVE_DECL..'
	now that autoconf always defines the HAVE_DECL_ symbols.
	* human.c: Likewise.
	* same.c: Likewise.
	* strtoumax.c: Likewise.

	* backupfile.c: Arrange for cpp to fail if the configure-time
	declaration check was not run.
	* hash.c: Likewise.
	* human.c: Likewise.
	* same.c: Likewise.
	* strtoumax.c: Likewise.

	* userspec.c (parse_user_spec): If there is no `:' but there is a `.',
	then first look up the entire `.'-containing string as a login name.

2000-02-18  Paul Eggert  <eggert@twinsun.com>

	* getdate.y: Handle two-digit years with leading zeros correctly.
	(textint): New typedef.
	(parser_control): Member year changed from int to textint.
	All uses changed.
	(YYSTYPE): Removed; replaced by %union with int and textint members.
	(tDAY, tDAY_UNIT, tDAYZONE, tHOUR_UNIT, tID, tLOCAL_ZONE, tMERIDIAN,
	tMINUTE_UNIT, tMONTH, tMONTH_UNIT tSEC_UNIT, tSNUMBER, tUNUMBER,
	tYEAR_UNIT, tZONE, o_merid): Now of type <intval>.
	(tSNUMBER, tUNUMBER): Now of type <textintval>.
	(date, number, to_year): Use width of number in digits, not its value,
	to determine whether it's a 2-digit year, or a 2-digit time.
	(yylex): Store number of digits of numeric tokens.
	Reported by John Kendall.

	(parser_control): Changed from struct parser_control to typedef (for
	consistency).  All uses changed.

	(tID): Removed; not used.
	(yylex): Return '?' for unknown identifiers, rather than (unused) tID.

2000-02-14  Paul Eggert  <eggert@twinsun.com>

	* getpagesize.h (getpagesize): Port to VMS for Alpha;
	adapted from changes to grep getpagesize.h by Martin P.J. Zinser.

2000-02-12  Jim Meyering  <meyering@lucent.com>

	* userspec.c (ISDIGIT): Define it.
	(isdigit): Remove definition.
	(is_number): Use ISDIGIT, not isdigit.
	<libintl.h>: Include.
	(_ and N_): Define.
	(parse_user_spec): Mark translatable strings.

2000-02-10  Jim Meyering  <meyering@lucent.com>

	With these changes, nanosleep.[ch] are finally enough like the other
	lib/* replacement files to compile on a few more losing systems.

	* nanosleep.h: Don't include config.h.
	Remove prototype from declaration of nanosleep.
	(PARAMS): Remove now-unneeded definition.
	* nanosleep.c: #undef nanosleep.
	(rpl_nanosleep): Rename from nanosleep.

2000-02-03  Jim Meyering  <meyering@lucent.com>

	* readutmp.c (read_utmp): Guard with `#ifdef UTMP_NAME_FUNCTION',
	rather than with `#if HAVE_UTMPNAME'.

2000-02-01  Jim Meyering  <meyering@lucent.com>

	* readutmp.h (UT_USER): Add parens.  From Andreas Schwab.

2000-01-31  Jim Meyering  <meyering@lucent.com>

	* nanosleep.h (nanosleep): Guard declaration with
	`#if ! HAVE_DECL_NANOSLEEP'.
	Without this, OFS gets a redeclaration error for rpl_nanosleep, due to
	the declaration in that vendor's sys/timers.h.
	Reported by Christian Krackowizer.

	* quotearg.c (ISASCII): Add #undef and move definition to follow
	inclusion of wctype.h to work around Solaris 2.6 namespace pollution.
	(ISPRINT): Likewise.
	Reported by Tom Tromey.

2000-01-30  Jim Meyering  <meyering@lucent.com>

	* readutmp.c (extract_trimmed_name): Use UT_USER instead of hard-coding
	uses of ->ut_name.  The latter doesn't work with new Linux header files
	where only utmpx.ut_user is declared.

	* readutmp.h (UT_USER): Define.

2000-01-23  Jim Meyering  <meyering@lucent.com>

	* Makefile.am (libfetish_a_SOURCES): Remove explicit mention of
	obstack.c.

2000-01-22  Jim Meyering  <meyering@lucent.com>

	* strtoumax.c: [! HAVE_DECL_STRTOUL]: Declare strtoul.
	[! HAVE_DECL_STRTOULL]: Declare strtoull.
	Required for some AIX systems.  Reported by Christian Krackowizer.
	[TESTING] (main): New function.

	1997-10-17  Eli Zaretskii  <eliz@is.elta.co.il>
	* dirname.c (dir_name): Support for DOS-style file names with drive
	letters.

	* quotearg.c [HAVE_WCTYPE_H]: Include <wctype.h> for decl of iswprint.

	* strverscmp.c (ISDIGIT): Define.
	(strverscmp): Use ISDIGIT, not isdigit.

2000-01-17  Paul Eggert  <eggert@twinsun.com>

	* nanosleep.c (nanosleep):
	Don't use SA_INTERRUPT to decide whether to call sigaction, as
	POSIX.1 doesn't require SA_INTERRUPT and some systems
	(e.g. Solaris 7) don't define it.  Use SA_NOCLDSTOP instead;
	it's been part of POSIX.1 since day 1 (in 1988).

2000-01-17  Jim Meyering  <meyering@lucent.com>

	* interlock: Remove unused file.  Reported by Franois Pinard.

2000-01-16  Paul Eggert  <eggert@twinsun.com>

	* quotearg.c (quotearg_buffer_restyled): Do not quote
	alert, backslash, formfeed, and vertical tab unnecessarily in
	shell quoting style.

Local Variables:
version-control: never
End:
